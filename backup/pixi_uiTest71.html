<!DOCTYPE html>
<html manifest="manifest.appcache">
<html>

<head>
    <title>Bootstrap 模板</title>
    <!-- 引入 Bootstrap -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" href="scripts/bootstrap/css/bootstrap.min.css">
    <link href="scripts/bootstrap/css/fileinput.min.css" rel="stylesheet">
    <link href="scripts/bootstrap/css/fileinput-rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="scripts/jqueryUI/jquery-ui.css">

    <script src="scripts/jqueryUI/external/jquery/jquery.js"></script>
    <script src="scripts/jqueryUI/jquery-ui.js"></script>
    <script src="scripts/pixi.min.js"></script>
    <script src="scripts/pixi_drawGraphic.js?1501"></script>
    <script src="scripts/PIXI_events.js?1500"></script>
    <!--<script src="scripts/PIXI_loaderData.js?1500"></script>
  	 <script src="scripts/PIXI_classTest.js"></script>-->

    <script src="scripts/bootstrap/js/bootstrap.min.js"></script>

    <script src="scripts/bootstrap/js/fileinput.min.js"></script>
    <script src="scripts/pixi_effectDataTemplate.js"></script>
    <script src="scripts/pixi_UI_slideBarModule.js"></script>
    

</head>

<body>

    <script>
        javascript: (function() {
            var script = document.createElement('script');
            script.onload = function() {
                var stats = new Stats();
                document.body.appendChild(stats.dom);
                requestAnimationFrame(function loop() {
                    stats.update();
                    requestAnimationFrame(loop)
                });
            };
            script.src = '//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';
            document.head.appendChild(script);
        })()


        console.log('start')


        // load setting Data json file,
        var PIXI_globalData = loadGlobalData();
        //let loader = new PIXI.loaders.Loader();

        var loader = PIXI.loader;
        var resources = PIXI.loader.resources;
        var Sprite = PIXI.Sprite,
            TextureCache = PIXI.utils.TextureCache,
            Rectangle = PIXI.Rectangle,
            Texture = PIXI.Texture


        var app = new PIXI.Application(1920, 1080, {
            backgroundColor: 0x1099bb
        });

        app.view.style.border = "3px dashed red";
        app.view.style.position = 'absolute';
        app.view.style.left = "410px";
        app.view.style.top = "5px";

        document.body.appendChild(app.view);


        var miniApp = new PIXI.Application(150, 150, {
            backgroundColor: 0x103366
        });
        miniApp.view.style.border = "2px solid brown";
        miniApp.view.style.position = 'absolute';
        miniApp.view.style.left = "200px";
        miniApp.view.style.top = "155px";

        document.body.appendChild(miniApp.view);

        //preLoadFile 




        //initial Data

        const containerList = {};
        const effectList = {};
        const eventList = {};


        //所有輸入的特效名稱
        const effectInputList = ["effect_A", "effect_B", "effect_C", "effect_D", "effect_E", "effect_F", "effect_G"];

        console.log("app.stage", app.stage);


        //initial Data END

        var loadEffect = {
            effectDataTemplate: {
                "spritesImageId": "",
                "spriteImage": "",
                "spriteImageURL": "",
                "frameList": "",
                "frameLength": "",
                "motionDataID": "",
                "motionDataURL": "",
                "motionData": "",
                "instancerCount": "",
                "instancerID": "",
                "ppID": "",
                "ppCount": "",
                "timeStart": "",
                "timeEnd": "",
                "timeLength": "",
                "sourceWidth": "",
                "sourceHeight": "",
                "screenWidth": "",
                "screenHeight": "",
                "sequence": "",
                "spritesData": "",
                "spritesImagesList": "",
                "spritesImagesSize": ""
            },

            loading_Progress: 0,
            createNew: function() {

                var effectData = {};

                effectData.newEvent = function(effectList, effectName) {
                    effectList[effectName] = effectDataTemplate;
                };

                effectData.readSources = function() {};
                effectData.readSpritesData = function(spritesID, spritesURL, effectName) {
                    const loader = new PIXI.loaders.Loader();
                    //loader.reset();
                    const resources = PIXI.loader.resources;
                    delete loader.resources[spritesID];
                    let templete
                    loader.add(spritesID, spritesURL)
                        .on("progress", loadProgressHandler)
                        .load(setup);

                    function loadProgressHandler(loader, resource) {
                        console.log("loading: " + resource.url);

                        console.log("progress: " + loader.progress + "%");

                        console.log("loading: " + resource.name);
                    }

                    function setup() {
                        //loadEffect.myData =  

                        var effectDataTemplate = {};
                        console.log("All files loaded", loader.progress);
                        //  console.log("loaderData",loader.resources[motionID].data); 
                        // effectList[effectName]= loader.resources
                        //  let motionData = resources[motionID]["data"];
                        //function(){}

                        let spritesData = loader.resources[spritesID].data;
                        let spritesDataFrames = spritesData.frames
                        var spritesImagesCount = Object.keys(spritesData.frames).length;
                        var spritesImagesList = Object.keys(spritesData.frames)
                        loadEffect.effectDataTemplate.spritesData = spritesData;
                        loadEffect.effectDataTemplate.spritesImageId = spritesID;
                        loadEffect.effectDataTemplate.spriteImage = spritesURL.split('.')[0] + ".png";
                        loadEffect.effectDataTemplate.frameList = Object.keys(spritesData.frames);
                        loadEffect.effectDataTemplate.frameLength = (Object.keys(spritesData.frames).length);
                        loadEffect.effectDataTemplate.spriteImageURL = spritesURL;
                        loadEffect.effectDataTemplate.spritesImagesList = spritesImagesList
                        loadEffect.effectDataTemplate.spritesImagesCount = spritesImagesCount
                        var spritesImagesSize = []
                        for (var i in spritesImagesList) {
                            console.log(spritesDataFrames[spritesImagesList[i]].frame)
                            spritesImagesSize.push(spritesDataFrames[spritesImagesList[i]].frame);
                        };

                        loadEffect.effectDataTemplate.spritesImagesSize = spritesImagesSize;
                        console.log("spritesData", spritesData, spritesDataFrames, spritesImagesSize);




                        console.log("Sprites laoder", loader.resources[spritesID]);

                        effectList[effectName] = loadEffect.effectDataTemplate;
                    };
                };
                effectData.readMotionData = function(motionID, motionURL, effectName) {

                    const loader = new PIXI.loaders.Loader()
                    //loader.reset();
                    const resources = PIXI.loader.resources;
                    delete loader.resources[motionID];
                    //let templete
                    loader.add(motionID, motionURL)
                        .on("progress", loadProgressHandler)
                        .load(setup);

                    function loadProgressHandler(loader, resource) {
                        console.log("loading: " + resource.url);

                        console.log("progress: " + loader.progress + "%");

                        console.log("loading: " + resource.name);
                    }

                    function setup() {
                        //loadEffect.myData =  
                        let motionData = loader.resources[motionID].data
                        let motionDataKeysCount = Object.keys(motionData).length;
                        let motionDataKeys = Object.keys(motionData);
                        var effectDataTemplate = {};
                        console.log("All files loaded", loader.progress);
                        //  console.log("loaderData",loader.resources[motionID].data); 
                        // effectList[effectName]= loader.resources
                        //  let motionData = resources[motionID]["data"];
                        //function(){}
                        loadEffect.loading_Progress = loader.progress;
                        loadEffect.effectDataTemplate.motionDataID = motionID;
                        loadEffect.effectDataTemplate.motionDataURL = motionURL;
                        loadEffect.effectDataTemplate.motionData = motionData;
                        loadEffect.effectDataTemplate.instancerCount = motionData.metaData.instancer_num;
                        loadEffect.effectDataTemplate.instancerID = Object.keys(motionData.instancer);
                        loadEffect.effectDataTemplate.timeStart = motionData.metaData.frame_start;
                        loadEffect.effectDataTemplate.timeEnd = motionData.metaData.frame_end;
                        loadEffect.effectDataTemplate.timeLength = motionData.metaData.frame_end - motionData.metaData.frame_start + 1;
                        loadEffect.effectDataTemplate.sourceWidth = motionData.metaData.source_width;
                        loadEffect.effectDataTemplate.sourceHeight = motionData.metaData.source_height;
                        loadEffect.effectDataTemplate.screenWidth = motionData.metaData.canvas_width;
                        loadEffect.effectDataTemplate.screenHeight = motionData.metaData.canvas_height;
                        loadEffect.effectDataTemplate.sequence = motionData.metaData.sequence;
                        let ppIDList = [];
                        for (let i = 0; i < motionDataKeysCount; i++) {
                            if (motionDataKeys[i].slice(0, 3) == "pId") {
                                ppIDList.push(motionDataKeys[i]);
                            };
                        };
                        loadEffect.effectDataTemplate.ppID = ppIDList;
                        loadEffect.effectDataTemplate.ppCount = motionData.metaData.particle_num;

                        //console.log("frameList",frameList)

                        effectList[effectName] = loadEffect.effectDataTemplate;
                        console.log("effectList_motion", effectList)

                    }
                    // console.log("loaderData_finall",loader.resources);

                };
                effectData.readData = function(motionID, motionURL, spritesID, spritesURL, effectName) {

                    const loader = new PIXI.loaders.Loader()
                    //loader.reset();
                    const resources = PIXI.loader.resources;
                    delete loader.resources[motionID];
                    delete loader.resources[spritesID];
                    //let templete
                    loader.add(motionID, motionURL)
                        .add(spritesID, spritesURL)
                        .on("progress", loadProgressHandler)
                        .load(setup);

                    function loadProgressHandler(loader, resource) {
                        console.log("loading: " + resource.url);

                        console.log("progress: " + loader.progress + "%");

                        console.log("loading: " + resource.name);
                    }

                    function setup() {
                        //loadEffect.myData =  

                        let motionData = loader.resources[motionID].data
                        let motionDataKeysCount = Object.keys(motionData).length;
                        let motionDataKeys = Object.keys(motionData);
                        var effectDataTemplate = {};
                        //  console.log("All files loaded", loader.progress);
                        //  console.log("loaderData",loader.resources[motionID].data); 
                        // effectList[effectName]= loader.resources
                        //  let motionData = resources[motionID]["data"];
                        //function(){}
                        loadEffect.loading_Progress = loader.progress;
                        loadEffect.effectDataTemplate.motionDataID = motionID;
                        loadEffect.effectDataTemplate.motionDataURL = motionURL;
                        loadEffect.effectDataTemplate.motionData = motionData;
                        loadEffect.effectDataTemplate.instancerCount = motionData.metaData.instancer_num;
                        loadEffect.effectDataTemplate.instancerID = Object.keys(motionData.instancer);
                        loadEffect.effectDataTemplate.timeStart = motionData.metaData.frame_start;
                        loadEffect.effectDataTemplate.timeEnd = motionData.metaData.frame_end;
                        loadEffect.effectDataTemplate.timeLength = motionData.metaData.frame_end - motionData.metaData.frame_start + 1;
                        loadEffect.effectDataTemplate.sourceWidth = motionData.metaData.source_width;
                        loadEffect.effectDataTemplate.sourceHeight = motionData.metaData.source_height;
                        loadEffect.effectDataTemplate.screenWidth = motionData.metaData.canvas_width;
                        loadEffect.effectDataTemplate.screenHeight = motionData.metaData.canvas_height;
                        loadEffect.effectDataTemplate.sequence = motionData.metaData.sequence;
                        let ppIDList = [];
                        for (let i = 0; i < motionDataKeysCount; i++) {
                            if (motionDataKeys[i].slice(0, 3) == "pId") {
                                ppIDList.push(motionDataKeys[i]);
                            };
                        };
                        loadEffect.effectDataTemplate.ppID = ppIDList;
                        loadEffect.effectDataTemplate.ppCount = motionData.metaData.particle_num;
                        let spritesData = loader.resources[spritesID].data;
                        let spritesDataFrames = spritesData.frames
                        var spritesImagesCount = Object.keys(spritesData.frames).length;
                        var spritesImagesList = Object.keys(spritesData.frames)
                        loadEffect.effectDataTemplate.spritesData = spritesData;
                        loadEffect.effectDataTemplate.spritesImageId = spritesID;
                        loadEffect.effectDataTemplate.spriteImage = spritesURL.split('.')[0] + ".png";
                        loadEffect.effectDataTemplate.frameList = Object.keys(spritesData.frames);
                        loadEffect.effectDataTemplate.frameLength = (Object.keys(spritesData.frames).length);
                        loadEffect.effectDataTemplate.spriteImageURL = spritesURL;
                        loadEffect.effectDataTemplate.spritesImagesList = spritesImagesList
                        loadEffect.effectDataTemplate.spritesImagesCount = spritesImagesCount
                        var spritesImagesSize = []
                        for (var i in spritesImagesList) {
                            //  console.log(spritesDataFrames[spritesImagesList[i]].frame)
                            spritesImagesSize.push(spritesDataFrames[spritesImagesList[i]].frame);
                        };

                        loadEffect.effectDataTemplate.spritesImagesSize = spritesImagesSize;
                        //console.log("spritesData",spritesData,spritesDataFrames,spritesImagesSize);




                        //console.log("Sprites laoder", loader.resources[spritesID]);

                        effectList[effectName] = loadEffect.effectDataTemplate;
                    }
                    // console.log("loaderData_finall",loader.resources);

                };

                effectData.readEffectEvent = function() {


                    loadEffect.loading_Progress += 20;
                    return loadEffect.loading_Progress
                    //loadEffect.myData = resources;

                };
                return effectData;
            }

        };


        var drawBox = {

            createNew: function() {
                var draw = {};
                draw.testA = "ggg";
                draw.testB = function() {
                    for (var i = 0; i < 10; i++) {
                        console.log(i)
                    }
                };
                draw.rect = function(x, y, w, h) {
                    console.log("testC")
                    var graphics = new PIXI.Graphics();

                    // set a fill and line style
                    graphics.beginFill(0xcc9999, 0.7);
                    graphics.lineStyle(1, 0xffd900, 1);
                    graphics.drawRect(x, y, w, h);

                    graphics.endFill();
                    graphics.pivot.x = w / 2;
                    graphics.pivot.y = h / 2;
                    graphics.x = app.renderer.screen.width / 2;
                    graphics.y = app.renderer.screen.height / 2;

                    return graphics;
                };
                draw.circle = function(x, y, r) {
                    var graphics = new PIXI.Graphics();
                    graphics.beginFill(0xaa2255, 1);
                    graphics.lineStyle(2, 0x000000, 1);
                    graphics.drawCircle(x, y, r);
                    graphics.endFill();
                    graphics.pivot.x = r;
                    graphics.pivot.y = r;
                    graphics.x = app.renderer.screen.width / 2;
                    graphics.y = app.renderer.screen.height / 2;
                    return graphics
                };
                draw.cross = function(x, y, length) {
                    var graphics = new PIXI.Graphics();
                    graphics.beginFill(0xcccccc, 1);
                    graphics.lineStyle(2, 0xcc3333, 1);
                    graphics.moveTo(x - length, 0);
                    graphics.lineTo(x + length, 0);
                    graphics.moveTo(0, y - length);
                    graphics.lineTo(0, y + length);
                    graphics.pivot.x = x;
                    graphics.pivot.y = y;
                    graphics.x = app.renderer.screen.width / 2;
                    graphics.y = app.renderer.screen.height / 2;
                    graphics.endFill();
                    return graphics

                };
                draw.drawBB = function(x, y, containerW, containerH) {
                    var graphics = new PIXI.Graphics();

                    // set a fill and line style
                    graphics.beginFill(0x33FFFF, 0.3);
                    graphics.lineStyle(2, 0xff0900, 1);
                    graphics.drawRect(0, 0, containerW, containerH);

                    graphics.endFill();
                    graphics.pivot.x = containerW / 2;
                    graphics.pivot.y = containerH / 2;
                    graphics.x = app.renderer.screen.width / 2;
                    graphics.y = app.renderer.screen.height / 2;
                    return graphics
                };
                return draw;
            } //注意格式，後面別加上;
        };

        var objectInfo = {
            createNew: function() {
                var selectedInfo = {};

                selectedInfo.getInfo = function(selectObject) {
                    console.log("selectObject", selectObject, selectObject.name);

                    var objectData = {
                        "name": selectObject.name,
                        "w": selectObject.width,
                        "h": selectObject.height,
                        "x": selectObject.x,
                        "y": selectObject.y,
                        "px": selectObject.pivot.x,
                        "py": selectObject.pivot.y,
                        "r": selectObject.rotation,
                        "alpha": selectObject.alpha,
                        "vis": selectObject.visible,
                        "children": selectObject.children,
                        "transform": selectObject.transform,
                        "parent": selectObject.parent
                    };
                    console.log(objectData);
                };

                return selectedInfo;
            } //注意格式，後面別加上;
        };

        var defineSpriteEvent = {

            createNew: function() {
                //console.log("effectList", effectList);
                var event = {};
                event.define = function(effectList, effectName, tick) {
                    var callEffectList = effectList[effectName];
                    var ppCount = callEffectList.ppCount;
                    var ppID = callEffectList.ppID;
                    var frameList = callEffectList.frameList;
                    var motionData = callEffectList.motionData;
                    var timeStart = callEffectList.motionData.metaData.frame_start;
                    var timeEnd = callEffectList.motionData.metaData.frame_end;
                    var timeLength = timeEnd - timeStart + 1;
                    var containerHeight = callEffectList.motionData.metaData.source_height;
                    var containerWidth = callEffectList.motionData.metaData.source_width;
                    var instancerCount = callEffectList.instancerCount;
                    var instancerID = callEffectList.instancerID;
                    var sourceImagesW = callEffectList.spritesImagesSize[0].w
                    var sourceImagesH = callEffectList.spritesImagesSize[0].h

                    var animSpritesList = [];
                    for (var i in frameList) {

                        animSpritesList.push(PIXI.Texture.fromFrame(frameList[i]));
                    };

                    for (var i = 0; i < instancerCount; i++) { //複製pp到instancer中
                        var effectContainer = new PIXI.Container();

                        effectContainer.name = "container_" + effectName;
                        containerList[effectName] = effectContainer
                        app.stage.addChild(effectContainer);

                        screenWidth = app.renderer.screen.width;
                        screenHeight = app.renderer.screen.height;
                        
                        
                        // container 置中
                        
                        effectContainer.pivot.x = containerWidth / 2 + effectContainer.width / 2 //freeze pivot and move to center
                        effectContainer.pivot.y = containerHeight / 2 + effectContainer.height / 2
                        effectContainer.x = screenWidth / 2;
                        effectContainer.y = screenHeight / 2;
                        /*
                        let container_Graphic = new PIXI.Container();
                        container_Graphic.name = "container_Grpahics";
                        let draw = drawBox.createNew();
                        let bb = draw.drawBB(0, 0, effectContainer.width, effectContainer.height)
                        container_Graphic.addChild(bb);
                        // container 置中  ^^^^^^
                        app.stage.addChild(container_Graphic)
                        */
                        var sideLength = containerWidth;
                        

                        for (var j = 0; j < ppCount; j++) { // <ppCount 為每個PP都建立一個anim event，< sampleCount 則為建立樣本數量
                            var anim = new PIXI.extras.AnimatedSprite(animSpritesList);
                            let ppIDKey = "pId_" + String(j);
                            var x = motionData[ppIDKey].translate[1].x; //[0]，在frame =0 時的取樣
                            var y = motionData[ppIDKey].translate[1].y;
                            var w = motionData[ppIDKey].scale[1].w;
                            var h = motionData[ppIDKey].scale[1].h;
                            var rotation = motionData[ppIDKey].rotate[1].angle;
                            var trans = motionData[ppIDKey].translate[1].trans;
                            var vis = motionData[ppIDKey].translate[1].vis;

                            var pw = motionData[ppIDKey].pivot_w;
                            var ph = motionData[ppIDKey].pivot_h;

                            var scale = w / sourceImagesW

                            //	anim.pivot.x =w *pw;
                            //	anim.pivot.y =h *ph
                            //console.log("pivot w h",anim.pivot.x,anim.pivot.y,ppIDKey,pw,ph);
                            anim.animationSpeed = 1; //frameSpeed; 播放速度

                            //anim.gotoAndPlay(0) //跳至sprites images中的 相對圖序

                            anim.play();

                            effectContainer.addChild(anim);
                            //anim.pivot.x =40;
                           // anim.pivot.x =80;
                           // anim.anchor.set(0.5);
                            //sprites 歸零            
                            //anim.pivot.x = 40
                            //anim.pivot.y = 80
                            //anim.pivot.x = pw * w;
                            //anim.pivot.y = ph * h;
                            //anim.x = -pw * w;
                            //anim.y = -ph * h;
                           // anim.width = w; // 圖寬
                            //anim.height = h; // 圖高

                            //anim.x = x - w / 2;
                            //anim.y = y - h / 2;
                           // console.log("anim.pivot", w, h, anim.pivot.x, anim.pivot.y)
                            //anim.rotation = -rotation / (180 / Math.PI); //旋轉
                        };
                    };
                };
                event.getSpritesData = function(effectName) { //收集spritesData
                    //var callEffectList = effectList[effectName];
                    // var effectContainerLIst = {};
                    // effectContainerLIst[]
                    // containerList[effectName] ={}

                    containerKeys = Object.keys(app.stage.children);
                    var allContainer = app.stage.children;
                    //  console.log("containerKeys",containerKeys);
                    var allContainerList = {};
                    var allEffectContainer = [];
                    var allBGContainer = [];
                    var allDrawContainer = [];
                    var allUIContainer = [];


                    for (var i in allContainer) {
                        //console.log("container", allContainer[i]);
                        let containerName = allContainer[i].name;
                        //console.log(containerName,containerName.split("_"));
                        if (containerName.split("_")[1] == "effect") {
                            allEffectContainer.push(allContainer[i])
                        } else if (containerName.split("_")[1] == "BG") {
                            allBGContainer.push(allContainer[i])
                        } else if (containerName.split("_")[1] == "draw") {
                            allDrawContainer.push(allContainer[i])
                        } else if (containerName.split("_")[1] == "UI") {
                            allUIContainer.push(allContainer[i])
                        };

                    };
                    var tempEffectList = {};
                    tempEffectList[effectName] = allEffectContainer;

                    allContainerList["effect"] = tempEffectList;
                    allContainerList["BG"] = allBGContainer;
                    allContainerList["Grpahics"] = allDrawContainer;
                    allContainerList["UI"] = allUIContainer;
                    console.log("allContainerList", allContainerList);
                    return allContainerList;
                    // console.log("spritesData",app.stage.children);

                };
                event.getAllAnimList = function(animEventList) { //調整anim/sprites的各種數據
                    //  console.log("dfdsfdd", animEventList)
                    var allAnimList = [];
                    // console.log("animEventList",animEventList);
                    for (i in animEventList) { //選取effect container
                        //console.log(i,animEventList[i]);

                        // console.log("animEventList.child",animEventList[i]) ; 
                        for (j in animEventList[i].children) {
                            // console.log(i,j)
                            var anim = animEventList[i].children[j];
                            //  console.log("anim",anim);
                            // anim.y =  -300;
                            // console.log("anim",animEventList[i].children[j]);
                            var anim = animEventList[i].children[j];
                            allAnimList.push(anim)
                        };

                    };
                    return allAnimList;

                };

                event.adjustAnimTransform = function(effectList, effectName, effectContainer, eventTick) {
                    //eventTick = 0
                    // console.log("eventTick",eventTick)
                    var callEffectList = effectList[effectName];
                    var ppCount = callEffectList.ppCount;
                    var ppID = callEffectList.ppID;
                    var frameList = callEffectList.frameList;
                    var motionData = callEffectList.motionData;
                    var timeStart = callEffectList.motionData.metaData.frame_start;
                    var timeEnd = callEffectList.motionData.metaData.frame_end;
                    var timeLength = timeEnd - timeStart + 1;
                    var containerHeight = callEffectList.motionData.metaData.source_height;
                    var containerWidth = callEffectList.motionData.metaData.source_width;
                    var instancerCount = 1 // callEffectList.instancerCount;
                    var instancerID = callEffectList.instancerID;





                    for (i in effectContainer) {
                        let instancerKey = "instancer_" + String(i);
                        // console.log("instancerKey",i,instancerKey);
                        let instancerData = motionData.instancer[instancerKey];
                        let offset = instancerData.offset; //instancer frame offset

                        //console.log(effectContainer[effectName].adjust)
                        var adjustTrans = PIXI_globalData[effectName].adjust.spritesTrans;
                        var adjustSize = PIXI_globalData[effectName].adjust.spritesSize;
                        var adjustRotation = PIXI_globalData[effectName].adjust.spritesRotation;
                        var adjustSpeed = PIXI_globalData[effectName].adjust.speed;
                        var adjustBlur = PIXI_globalData[effectName].adjust.spritesBlur;
                        // console.log("offset",offset)

                        if ((offset - eventTick) > 0) {
                            var offsetEventTick = 0;
                            var trans = 0;

                        } else {
                            var offsetEventTick = eventTick - offset



                        };
                        var containerX = instancerData.translate[offsetEventTick].x;
                        var containerY = instancerData.translate[offsetEventTick].y;
                        var containerTrans = instancerData.translate[offsetEventTick].trans;
                        //var containerW = instancerData.scale[offsetEventTick].w;
                        // var containerH = instancerData.scale[offsetEventTick].h;
                        var containerRotation = instancerData.rotate[offsetEventTick].angle;
                        var container_bbw = instancerData.bbox_w;
                        var container_bbh = instancerData.bbox_h;
                        var container_pw = instancerData.pivot_w;
                        var container_ph = instancerData.pivot_h;
                        effectContainer[i].pivot.x =containerWidth/2+ container_pw ;
                        effectContainer[i].pivot.y =containerHeight/2+ container_ph ;
                       // effectContainer[i].pivot.y =0//container_ph + effectContainer[i].height/2;
                       // console.log("container wh",effectContainer[i].width,effectContainer[i].height,effectContainer[i].pivot.x,effectContainer[i].pivot.y);
                        
                        effectContainer[i].x = containerX +container_pw;
                        effectContainer[i].y = containerY +container_ph;
                        effectContainer[i].rotation = -containerRotation/(180/Math.PI);
                        effectContainer[i].alpha = containerTrans;
    
                        // console.log("chgange2")
                        // effectContainer[i].x = containerX;
                       // effectContainer[i].y = containerY;
                        //console.log(effectContainer[i].pivot.x,effectContainer[i].pivot.y)
                        // effectContainer[i].width = containerW;
                        //effectContainer[i].height = containerH;
                        // effectContainer[i].alpha = containerTrans;
                        // effectContainer[i].rotation = -containerRotation/57.3;
                      //  console.log("1", "containerX",containerX,"containerY", containerY,"container_bbw", container_bbw,"container_bbh", //container_bbh,"container_pw", container_pw,"container_ph", container_ph,"containerRotation",containerRotation)
                        for (j in effectContainer[i].children) {
                            let ppIDKey = "pId_" + String(j)

                            //   console.log(ppIDKey);
                            var x = motionData[ppIDKey].translate[offsetEventTick].x;
                            var y = motionData[ppIDKey].translate[offsetEventTick].y;
                            var w = motionData[ppIDKey].scale[offsetEventTick].w * adjustSize;
                            var h = motionData[ppIDKey].scale[offsetEventTick].h * adjustSize;
                            var rotation = motionData[ppIDKey].rotate[offsetEventTick].angle + adjustRotation;
                            var trans = motionData[ppIDKey].translate[offsetEventTick].trans * adjustTrans;
                            var vis = motionData[ppIDKey].translate[offsetEventTick].vis;
                            var pw = motionData[ppIDKey].pivot_w;
                            var ph = motionData[ppIDKey].pivot_h;
                            var pp = effectContainer[i].children[j];

                           
                            pp.anchor.set(pw,ph);  // set to pivot scale  
                            pp.x = x  +(-0.5*w + w*pw) // 0.5 * width + width*(pivot width scale)
                            pp.y = y +(-0.5*h + h*ph)// 0.5 * height + height*(pivot height scale)

                            pp.width = w;
                            pp.height = h ;
                            pp.alpha = trans;
                            pp.rotation = -rotation / 57.3;
                            pp.animationSpeed = adjustSpeed; //frameSpeed; 播放速度
                            pp.gotoAndPlay(0)
                            
                            //console.log("adjustSpeed",adjustSpeed)
                            
                            

                        };

                    };


                };
                event.getStageData = function() {
                    console.log("app.stage", app.stage);
                };

                event.runSpritesFequence = function(allAnimSpritesList, timeLength) { //測試動態
                    console.log("allAnimSpritesList", allAnimSpritesList);
                    var tick = 0;
                    tick +=1;
                    tick = tick % timeLength;
                    app.ticker.add(function() {

                        for (i in allAnimSpritesList) {
                            //allAnimSpritesList[i]
                            //  console.log("allAnimSpritesList",allAnimSpritesList[i]);
                            var anim = allAnimSpritesList[i]; //取得個別 sprite / anim

                            anim.y += Math.random() * 300

                            //anim.alpha = 60*0.2


                        };
                    });
                };

                event.runApp = function(effectList, effectName) {
                    event.define(effectList, effectName);
                    var callEffectList = effectList[effectName];

                    var timeStart = callEffectList.motionData.metaData.frame_start;
                    var timeEnd = callEffectList.motionData.metaData.frame_end;
                    var timeLength = timeEnd - timeStart + 1;
                    var getAllContainerList = event.getSpritesData(effectName);
                    //  console.log("getAllContainerList", getAllContainerList["effect"][effectName]);
                    var allAnimList = event.getAllAnimList(getAllContainerList["effect"][effectName]);
                    // console.log("allAnimList", allAnimList);
                    var tick = 0
                    app.ticker.add(function() {
                        
                        var speed = PIXI_globalData[effectName].adjust.speed
                        tick += Math.floor(speed);
                        eventTick = tick % timeLength;
                        event.adjustAnimTransform(effectList, effectName, getAllContainerList["effect"][effectName], eventTick)
                    });

                };
                return event;
            }

        };

        function WriteToFile(text) {


            window.location.href = image;

        }
        var JsonData = ""



        function myFunction() {
            // deleteAllChildrenInStage("container_BG");

            var getStageInfo = defineSpriteEvent.createNew();
            //var defineEffectA = defineSpriteEvent.createNew();
            //defineEffectA.define(effectList,"effect_A");
            //console.log("effectList",effectList);
            // getStageInfo.getStageData();

            var getAnimEventList = getStageInfo.getSpritesData("effect_A")["effect"]["effect_A"];
            console.log("allEffectSprites", getAnimEventList);
            var getAllAnimSpritesList = getStageInfo.appayAnimAdjust(getAnimEventList, 0);
            console.log("getAllAnimSpritesList", getAllAnimSpritesList);
            //  getStageInfo.runSpritesFequence(getAllAnimSpritesList,60);

        };


        function deleteAllChildrenInStage(deleteConteinaerName) {
            app.stop();
            app.ticker.stop();
            var itemCount = app.stage.children.length;
            //console.log("show app",app);
            //console.log("totalItemCount",itemCount);
            var deleteItemCount = 0;
            var undeleteIndexList = [];
            var deleteIndexList = [];

            for (var i = 0; i < itemCount; i++) {
                var checkContainerName = app.stage.children[i].name;
                if (checkContainerName == deleteConteinaerName) {
                    // console.log("delete Item", app.stage.children[i].name)
                    //app.stage.removeChild( app.stage.children[i]);
                    deleteIndexList.push(i);
                } else {
                    deleteItemCount += 1;
                    undeleteIndexList.push(i);
                };

            };

            for (var i in deleteIndexList) {
                var j = deleteIndexList[i]
                //     console.log("delete index", deleteIndexList[i]);
                while (app.stage.children[j]) {
                    app.stage.removeChild(app.stage.children[j])
                };

            };
            //console.log("show undeleteItem",app.stage.children.length,app.stage);
        };











        function callEffect(motionID, motionURL, spritesID, spritesURL, effectName) {
            var loadEffectA = loadEffect.createNew();
            (motionID, motionURL, spritesID, spritesURL, effectName)
            loadEffectA.readData(motionID, motionURL, spritesID, spritesURL, effectName)
            // loadEffectA.readData("motionData", "json/effect_a_dot.json", "spritesData", "sprites/color_circle.json", "effect_B")

        };

        callEffect("motionData", "json/test_F.json?1500", "spritesData", "sprites/effect_a_item.json?1501", "effect_A");

        $(document).ready(function() {
            $("#testAll").click(function() {
                console.log("test start 001");

                console.log("PIXI_globalData",PIXI_globalData);
                deleteAllChildrenInStage("container_Grpahics");
                deleteAllChildrenInStage("container_BG")
                deleteAllChildrenInStage("container_effect")
                setBG();
                //testGraphic
                var container_Graphic = new PIXI.Container();
                container_Graphic.name = "container_Grpahics";
                var drawA = drawBox.createNew();
                var rectA = drawA.rect(0, 0, 1080, 1080);
                rectA.x = app.renderer.screen.width/2;
                rectA.y = app.renderer.screen.height/2
                var circleA = drawA.circle(15, 15, 15);

                var crossA = drawA.cross(0, 0, 50);

                container_Graphic.addChild(rectA);
                container_Graphic.addChild(circleA);

                container_Graphic.addChild(crossA);

                console.log("effectList", effectList)


                console.log("loader", loader);
 
                
                app.stage.addChild(container_Graphic);
                
                var defineEffectA = defineSpriteEvent.createNew();
                defineEffectA.runApp(effectList, "effect_A");
                
                
                console.log("effectList",effectList);

            });


            $("#resetA").click(function() {
                console.log("resetA")

            });
            $("#applyA").click(function() {

                console.log(PIXI_globalData.effect_A.spritesImageMode, typeof PIXI_globalData.effect_A.spritesImageMode);
                //frameListA = Object.keys(resources.spritesImagesJsonA.data.frames);
                if (PIXI_globalData.effect_A.spritesImageMode == 0) {
                    console.log("singal frame");
                    var stillImageA = document.getElementById("stillImageNameA").value;
                    PIXI_globalData.effect_A.stillImageName = stillImageA;

                    appendListInfoIntoTextarea(frameListA);

                    checkImageInSpritesSheet(stillImageA, frameListA);
                } else {
                    console.log("sequence frame");
                    PIXI_globalData.effect_A.stillImageName = "sequence images";
                    var spritesSpeed = PIXI_globalData.effect_A.adjust.frameSpeed;
                    console.log(spritesSpeed)

                };

            });
        });
        var renderEvent = []

        function PIXI_loader(id, url) {

            //app.stop();
            //delete loader.resources[id];
            loader
                .add(id, url)
                .load(setup);

            function setup() {
                console.log("loading " + id)

            };
            //app.start();

        };



        function showMessage() {
            var container_message = new PIXI.Container();
            container_message.name = "container_message"
            // console.log("message")
            var stageCount = app.stage.children.length;
            var styleC = new PIXI.TextStyle({

                fontFamily: 'Arial',
                fontSize: 20,
                fill: ['#ffffff', '#00ff99'], // gradient
                stroke: '#4a1850',
                strokeThickness: 1,
                dropShadow: true,
                dropShadowColor: '#000000',
                dropShadowBlur: 1,
                dropShadowAngle: Math.PI / 6,
                dropShadowDistance: 1,
                wordWrap: true,
                wordWrapWidth: 440
            });

            var stageCountText = new PIXI.Text("stageCount : " + stageCount, styleC);
            stageCountText.x = 500;
            stageCountText.y = 30;
            container_message.addChild(stageCountText);
            app.stage.addChild(container_message);
            app.stage.removeChild("container_message")
            //console.log("message end")


        };



        function appendListInfoIntoTextarea(dataList) {
            //$("#info").val("images:");
            var frameList = ""
            for (var i in dataList) {
                frameList += (dataList[i] + " \n");
                //$("#info").append(dataList[i]);
            };
            //console.log("frameList",frameList);
            $("#info").val(frameList)
        };

        function checkImageInSpritesSheet(spriteName, spritesList) {
            var checkExist = jQuery.inArray(spriteName, spritesList);
            if (checkExist == -1) {
                console.log("檔案不存在(sprite Image)");
                document.getElementById("stillImageNameA").value = "檔案不存在(sprite Image)";
            } else {
                console.log(checkExist, spritesList[checkExist]);
                var sprite = addSprite(spriteName);
                console.log("sprite", sprite);
                app.stage.addChild(sprite);

            };
        };

        //創建anim Sprites event List  , animSpritesList(將序列的sprties images建立成一個連續撥放的list),anim(使用PIXI.extras.AnimatedSprite將 animSpritesList建立為PIXI的動態撥放事件)

    </script>


</body>

<body>

    <div class="container-fluid">

        <div class="row-fluid">

            <div class="col-xs-6 span4" style="background-color: rgb(230,230,200);padding:3px;margin:1px;width:380px; ">

                <div class="row-fluid" id="inputBG_Dialog" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;height: 300px">
                    <div>
                        <button class="btn btn-warning" id="testAll" style="width:100px;font-size:16px;padding-left: 3px;line-height: 25px;margin-top: 5px">testA</button>
                    </div>
                    <div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


                        <button class="btn btn-info dropdown-toggle" type="button" id="screenModeButton" data-toggle="dropdown" style="margin-left: -2px; width: 280px;height: 30px;line-height: 23px; padding: 1px;text-align: center;">版型選擇
                            <span class="caret"></span></button>
                        <ul class="dropdown-menu" role="presentation" aria-labelledby="screenModeButton" id="screenMode_databox">
                            <li role="presentation"><a role="menuitem" tabindex="0" href="#">1. 1920 1080 , scale=1 solt game h5</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="1" href="#">2. 960 540 , scale=0.5 solt game h5</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="1" href="#">3. 1280 720 , scale=1 test A</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="1" href="#">4. 1024 1024 , scale=1 test B</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="1" href="#">5. 1000 700 , scale=1 slot Game flash</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="1" href="#">6. 800 800 , scale=1 test D</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="1" href="#">7. 400 400 , scale=1 test E</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="0" href="#">1. 2048 2048 , scale=1 solt game h5</a></li>

                            <li role="presentation" class="divider"></li>
                            <li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
                        </ul>

                    </div>

                    <div class="col-xs-3 span2" style="width:300px;font-size: 14px">
                        <input type="file" id="inputBGA">
                        <input type="text" id="showBGA" value="選取背景圖檔" style="width:260px;height: 16px; color:darkcyan;text-align:center;margin: 2px;line-height: 20px;"><br>


                        <span>BG color: </span><input type="color" id="colorBGA" value="#11aaaa" style="width:50px;height: 20px; margin-top: 5px;color:darkcyan;padding: 1px;text-align:center;"><br>
                        <button id="BGA_apply" class="btn btn-success" onclick="setBG()" style="height: 25px;width:100px;margin-top: 5px;">APPLY</button>



                    </div>
                </div>
                <div id="infoBox" style="background-color:rgb(250,250,250);padding:5px;width:360px;border-radius: 10px;">
                    <textarea id="info" style="width:340px;height: 50px;margin: 0px"></textarea>

                </div>
                <div style=" padding: 5px;letter-spacing: 1px;">
                    <!-- Right  inputDataA-->

                    <button id="input_a" class="btn btn-success">素材 A</button><small class="text-info" style=" padding-left: 10px;">點選展開 </small>


                    <div id="inputDataA">

                        <div id="inputADialog_1" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;">
                            <p style=" padding-left: 10px; ">圖檔模式:</p>
                            <form action="">
                                <div class="container-fluid" style=" padding-left: 15px;">
                                    <input type="radio" name="optionsRadiosinline" id="optionsRadiosA1" value="option1"> 單張圖:
                                    <input type="text" id="stillImageNameA" class="text-info" style="width:180px;padding:0px;margin-bottom: -2px;font-size: 12px;color:darkgray">
                                    <button id="inputExtA" class="btn btn-info" style="line-height: 10px;width: 50px; font-size: 10px">展開</button><br>
                                    <input type="radio" name="optionsRadiosinline" id="optionsRadiosA2" value="option2" checked> 連續圖
                                </div>
                            </form>
                            <div class="row" style=" padding-left: 5px; margin: 5px;width:350; ">
                                <div class="col-xs-3 span2" style="width:110px;line-height: 35px;">
                                    <input type="file" id="inputJsonA">
                                    <input type="file" id="inputSpriteJsonA">
                                    <input type="file" id="stageDescriptJsonA">

                                </div>
                                <div class="col-xs-3 span5" style="width:200px">
                                    <input type="text" id="showMotionJsonA" value="選取動態JSON檔案" style="width:200px;margin-top: 4px;color:darkcyan;">
                                    <input type="text" id="showSpriteJsonA" value="選取Sprites JSON檔案" style="width:200px;margin-top: -6px;color:darkcyan;">
                                    <input type="text" id="showStageDescriptJsonA" value="選取stage描述JSON檔案" style="width:200px;margin-top: -4px;color:darkcyan;">

                                </div>
                            </div>


                            <div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


                                <button class="btn btn-warning dropdown-toggle" type="button" id="menuA_blendMode" data-toggle="dropdown" style="width: 120px;padding: 1px;">混色模式
                            <span class="caret"></span></button><text id="blendModeTextA" style="padding-left:15px;color:darkcyan ">選擇混色模式</text><br>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="menuA_blendMode" id="databoxA">
                                    <li role="presentation"><a role="menuitem" tabindex="0" href="#">NORMAL</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="1" href="#">ADD</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="2" href="#">MULTIPKY</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="3" href="#">SCREEN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="4" href="#">OVERLAY</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="5" href="#">LIGHTEN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="6" href="#">COLOR_DODGE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="7" href="#">COLOR_BURN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="8" href="#">HARD_LIGHT</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="9" href="#">SOFT_LIGHT</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="10" href="#">DIFFERENCE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="11" href="#">EXCLUSION</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="12" href="#">HUE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="13" href="#">SATURATION</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="14" href="#">COLOR</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="15" href="#">LUMINOSITY</a></li>
                                    <li role="presentation" class="divider"></li>
                                    <li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
                                </ul>

                            </div>

                        </div>

                        <div class="row" id="inputADialog_2" style="background-color:rgb(250,250,250);padding:0px;width:360px;margin:5px;border-radius: 10px;">
                            <h5 style="padding-left:12px">細部調整</h5>
                            <div class="col-xs-6 span4" style="font-size: 12px ;margin-left: 5px;line-height: 23px;margin-top: 12px">
                                speed <br>
                                <line></line>
                                frame Speed <br> Sprites Size <br> <span style="font-size: 12px"> random Size </span> <br> Sprites Rotate <br>rotate Random<br> frame Offset<br>Sprite Trans <br>Sprite Blur <br>
                            </div>
                            <div class="col-xs-6 span2" style="margin: 5px; line-height: 23px;">
                                <div id="speedSliderA" style="margin:10px;width:200px;height: ">
                                    <!-- slide bar -->

                                    <div id="speedSliderA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="frameSpeedA" style="margin:10px;width:200px">
                                    <div id="frameSpeedA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpritesSizeA" style="margin:10px;width:200px">
                                    <div id="SpritesSizeA-handle" class="ui-slider-handle " style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpritesSizeRandomA" style="margin:10px;width:200px">
                                    <div id="SpritesSizeRandomA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpritesRotateA" style="margin:10px;width:200px">
                                    <div id="SpritesRotateA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpritesRotateRandomA" style="margin:10px;width:200px">
                                    <div id="SpritesRotateRandomA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpritesframeOffsetA" style="margin:10px;width:200px">
                                    <div id="SpritesframeOffsetA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpriteTransA" style="margin:10px;width:200px">
                                    <div id="SpriteTransA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <div id="SpriteBlurA" style="margin:10px;width:200px">
                                    <div id="SpriteBlurA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
                                </div>
                                <button id="resetA" type="button" class="btn btn-info" style="height: 23px;width:100px;">RESET</button>
                                <button id="applyA" type="button" class="btn btn-success" style="height: 23px;width:100px;margin-top: 5px;">APPLY</button>

                            </div>
                        </div>

                    </div>

                </div>
                <div style=" padding: 5px;letter-spacing: 1px;">
                    <!-- Right  inputDataB-->

                    <button id="inputB" class="btn btn-success">素材 B</button><small class="text-info" style=" padding-left: 10px;">點選展開 </small>


                    <div id="inputDataB">

                        <div id="inputBDialog_1" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;">
                            <p style=" padding-left: 10px; ">圖檔模式:</p>
                            <form action="">
                                <div class="container-fluid" style=" padding-left: 3px;">
                                    <input type="radio" name="optionsRadiosinline" id="optionsRadiosB1" value="option1"> 單張圖
                                    <input type="radio" name="optionsRadiosinline" id="optionsRadiosB2" value="option2" checked> 連續圖
                                </div>
                            </form>
                            <div class="row" style=" padding-left: 5px; margin: 5px;width:350; ">
                                <div class="col-xs-3 span2" style="width:110px;line-height: 35px;">
                                    <input type="file" id="inputJsonB">
                                    <input type="file" id="inputSpriteJsonB">
                                    <input type="file" id="inputSprtieImageB">

                                </div>
                                <div class="col-xs-3 span5" style="width:200px">
                                    <input type="text" id="showMotionJsonB" value="選取動態JSON檔案" style="width:200px;margin-top: 4px;color:darkcyan;">
                                    <input type="text" id="showSpriteJsonB" value="選取Sprites JSON檔案" style="width:200px;margin-top: -6px;color:darkcyan;">
                                    <input type="text" id="showSpriteImageB" value="選取Sprite Image檔案" style="width:200px;margin-top: -4px;color:darkcyan;">

                                </div>
                            </div>


                            <div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


                                <button class="btn btn-warning dropdown-toggle" type="button" id="menuB_blendMode" data-toggle="dropdown" style="width: 120px;padding: 1px;">混色模式
                            <span class="caret"></span></button><text id="blendModeTextB" style="padding-left:15px;color:darkcyan;">選擇混色模式</text><br>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="menuB_blendMode">
                                    <li role="presentation"><a role="menuitem" tabindex="0" href="#">NORMAL</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="1" href="#">ADD</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="2" href="#">MULTIPKY</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="3" href="#">SCREEN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="4" href="#">OVERLAY</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="5" href="#">LIGHTEN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="6" href="#">COLOR_DODGE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="7" href="#">COLOR_BURN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="8" href="#">HARD_LIGHT</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="9" href="#">SOFT_LIGHT</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="10" href="#">DIFFERENCE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="11" href="#">EXCLUSION</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="12" href="#">HUE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="13" href="#">SATURATION</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="14" href="#">COLOR</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="15" href="#">LUMINOSITY</a></li>
                                    <li role="presentation" class="divider"></li>
                                    <li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
                                </ul>

                            </div>
                        </div>
                        <div class="row" id="inputBDialog_2" style="background-color:rgb(250,250,250);padding:0px;width:350px;margin:5px;border-radius: 10px;">
                            <h5 style="padding-left:12px">細部調整</h5>
                            <div class="col-xs-6 span4" style="font-size: 12px ;margin-left: 5px;line-height: 22px;margin-top: 12px">
                                speed <br>
                                <line></line>
                                frame Speed <br> Sprites Size <br> <span style="font-size: 12px"> random Size </span> <br> Sprites Rotate <br> Sprite Blur <br>
                            </div>
                            <div class="col-xs-6 span2" style="margin: 5px">
                                <div id="speedSliderB" style="margin:10px;width:200px;">
                                    <!-- slide bar -->

                                    <div id="speedSliderB-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="frameSpeedB" style="margin:10px;width:200px">
                                    <div id="frameSpeedB-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpritesSizeB" style="margin:10px;width:200px">
                                    <div id="SpritesSizeB-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpritesSizeRandomB" style="margin:10px;width:200px">
                                    <div id="SpritesSizeRandomB-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpritesRotateB" style="margin:10px;width:200px">
                                    <div id="SpritesRotateB-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpriteBlurB" style="margin:10px;width:200px">
                                    <div id="SpriteBlurB-handle" class="ui-slider-handle"></div>
                                </div>
                                <button id="resetB" type="button" class="btn btn-info" style="height: 25px;width:100px;">RESET</button>
                                <button id="applyB" type="button" class="btn btn-success" style="height: 25px;width:100px;margin-top: 5px;">APPLY</button>

                            </div>
                        </div>

                    </div>

                </div>
                <div style=" padding: 5px;letter-spacing: 1px;">
                    <!-- Right  inputDataC-->

                    <button id="inputC" class="btn btn-success">素材 C</button><small class="text-info" style=" padding-left: 10px;">點選展開 </small>


                    <div id="inputDataC">

                        <div id="inputCDialog_1" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;">
                            <p style=" padding-left: 10px; ">圖檔模式:</p>
                            <form action="">
                                <div class="container-fluid" style=" padding-left: 3px;">
                                    <input type="radio" name="optionsRadiosinline" id="optionsRadiosC1" value="option1"> 單張圖
                                    <input type="radio" name="optionsRadiosinline" id="optionsRadiosC2" value="option2" checked> 連續圖
                                </div>
                            </form>
                            <div class="row" style=" padding-left: 5px; margin: 5px;width:350; ">
                                <div class="col-xs-3 span2" style="width:110px;line-height: 35px;">
                                    <input type="file" id="inputJsonC">
                                    <input type="file" id="inputSpriteJsonC">
                                    <input type="file" id="inputSprtieImageC">

                                </div>
                                <div class="col-xs-3 span5" style="width:200px">
                                    <input type="text" id="showMotionJsonC" value="選取動態JSON檔案" style="width:200px;margin-top: 4px;color:darkcyan;">
                                    <input type="text" id="showSpriteJsonC" value="選取Sprites JSON檔案" style="width:200px;margin-top: -6px;color:darkcyan;">
                                    <input type="text" id="showSpriteImageC" value="選取Sprite Image檔案" style="width:200px;margin-top: -4px;color:darkcyan;">

                                </div>
                            </div>


                            <div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


                                <button class="btn btn-warning dropdown-toggle" type="button" id="menuC_blendMode" data-toggle="dropdown" style="width: 120px;padding: 1px;">混色模式
                            <span class="caret"></span></button><text id="blendModeTextC" style="padding-left:15px;color:darkcyan ">選擇混色模式</text><br>
                                <ul class="dropdown-menu" role="menu" aria-labelledby="menuC_blendMode">
                                    <li role="presentation"><a role="menuitem" tabindex="0" href="#">NORMAL</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="1" href="#">ADD</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="2" href="#">MULTIPKY</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="3" href="#">SCREEN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="4" href="#">OVERLAY</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="5" href="#">LIGHTEN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="6" href="#">COLOR_DODGE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="7" href="#">COLOR_BURN</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="8" href="#">HARD_LIGHT</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="9" href="#">SOFT_LIGHT</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="10" href="#">DIFFERENCE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="11" href="#">EXCLUSION</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="12" href="#">HUE</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="13" href="#">SATURATION</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="14" href="#">COLOR</a></li>
                                    <li role="presentation"><a role="menuitem" tabindex="15" href="#">LUMINOSITY</a></li>
                                    <li role="presentation" class="divider"></li>
                                    <li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
                                </ul>

                            </div>
                        </div>
                        <div class="row" id="inputCDialog_2" style="background-color:rgb(250,250,250);padding:0px;width:350px;margin:5px;border-radius: 10px;">
                            <h5 style="padding-left:12px">細部調整</h5>
                            <div class="col-xs-6 span4" style="font-size: 12px ;margin-left: 5px;line-height: 22px;margin-top: 12px">
                                speed <br>
                                <line></line>
                                frame Speed <br> Sprites Size <br> <span style="font-size: 12px"> random Size </span> <br> Sprites Rotate <br> Sprite Blur <br>
                            </div>
                            <div class="col-xs-6 span2" style="margin: 5px">
                                <div id="speedSliderC" style="margin:10px;width:200px;">
                                    <!-- slide bar -->

                                    <div id="speedSliderC-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="frameSpeedC" style="margin:10px;width:200px">
                                    <div id="frameSpeedC-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpritesSizeC" style="margin:10px;width:200px">
                                    <div id="SpritesSizeC-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpritesSizeRandomC" style="margin:10px;width:200px">
                                    <div id="SpritesSizeRandomC-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpritesRotateC" style="margin:10px;width:200px">
                                    <div id="SpritesRotateC-handle" class="ui-slider-handle"></div>
                                </div>
                                <div id="SpriteBlurC" style="margin:10px;width:200px">
                                    <div id="SpriteBlurC-handle" class="ui-slider-handle"></div>
                                </div>
                                <button id="resetC" type="button" class="btn btn-info" style="height: 25px;width:100px;">RESET</button>
                                <button id="applyC" type="button" class="btn btn-success" style="height: 25px;width:100px;margin-top: 5px;">APPLY</button>

                            </div>
                        </div>

                    </div>

                </div>
                <div class="input-group" style="padding:12px; ">
                    <h6>輸出圖檔</h6>
                    <span class="input-group-addon" style="height: 20px; ">起始格</span>
                    <input id="startFrame" type="number" class="form-control" name="startFrameMsg" value="1" style="text-align: center; width:30px ; height:16px;">
                    <span class="input-group-addon" style="padding:3px; ">結束格</span>
                    <input id="endFrame" type="number" class="form-control" name="endFrameMsg" value="1" style="text-align: center; width:30px ; height:16px;"> <br>
                    <button type="button" class="btn btn-info" onclick="WriteToFile()">輸出圖檔</button>

                </div>
                <div>
                    <h1>testtesttest</h1>
                    <input type="file" accept="text/json" onchange="openFile(event)"><br>
                    <button onclick="myFunction()">Click me</button>
                </div>

            </div>


            <div class="col-xs-6 -fluid" style="background-color: black;height:2000px; margin-left: 1px" ;>
                <!-- Left -->



            </div>

        </div>
    </div>
</body>
<!--initial data -->


<script>
    var KJJsonInputStyleA = {
        rtl: false,
        showPreview: false,
        showRemove: false,
        showUpload: false,
        showCancel: false,
        showCaption: false,
        browseClass: "btn btn-info",
        browseLabel: "選取檔案",
        allowedFileExtensions: ["json", "JSON"]
    };

    var KJImageInputStyleA = {
        rtl: false,
        showPreview: false,
        showRemove: false,
        showUpload: false,
        showCancel: false,
        showCaption: false,
        browseClass: "btn btn-success",
        browseLabel: "選取檔案",
        allowedFileExtensions: ["jpg", "png"]
    }


    $(document).ready(function() {
        $("#inputDataA").show();
        $("#inputDataB").hide();
        $("#inputDataC").hide();
        $("#input_a").click(function() {
            $("#inputDataA").toggle();
        });
        $("#inputB").click(function() {
            $("#inputDataB").toggle();
        });
        $("#inputC").click(function() {
            $("#inputDataC").toggle();
        });
        $("#infoBox").show();
        $("#inputExtA").click(function() {
            $("#infoBox").toggle();
        });
    });

    $("#screenMode_databox a").click(function(e) {
        e.preventDefault(); // cancel the link behaviour
        var screenModeText = $(this).text();
        $("#screenModeButton").text(screenModeText);
        var screenWidth = parseInt(screenModeText.split(" ")[1]);
        var screenHeight = parseInt(screenModeText.split(" ")[2]);
        var screenScale = parseFloat(screenModeText.split(" ")[4].split("=")[1]);
        console.log(screenWidth, screenHeight);
        PIXI_globalData.BGA.width = screenWidth;
        PIXI_globalData.BGA.height = screenHeight;
        PIXI_globalData.BGA.screenScale = screenScale;
        // console.log(screenScale);
        //$("#showScreenModeText").val(selText);
    });

    //get Bootstrap dropdown value inputADialog_3
    $("#databoxA a").click(function(e) {
        e.preventDefault(); // cancel the link behaviour
        var selText = $(this).text();
        $("#menuA_blendMode").text(selText);

        PIXI_globalData.effect_A.blendMode = selText
    });

    $("#inputBGA").fileinput(KJImageInputStyleA);


    $('#inputBGA').on('fileloaded', function(event, data, previewId, index) {
        $("#showBGA").val("images/" + data.name);
        delete loader.resources["BGA_image"];
        var imageURL = "images/" + data.name
        PIXI_globalData.BGA.URL = imageURL;
        PIXI_loader("BGA_image", imageURL);
    });



    //input A----------------------------

    $(document).ready(function() {
        $("#optionsRadiosA1").click(function() {
            console.log('still Image');
            PIXI_globalData.effect_A.spritesImageMode = 0;
        });
        $("#optionsRadiosA2").click(function() {
            console.log('sequence Images');
            PIXI_globalData.effect_A.spritesImageMode = 1;
        });
    });




    $("#inputJsonA").fileinput(KJJsonInputStyleA); //load motion JsonA

    $('#inputJsonA').on('fileloaded', function(event, data, previewId, index) {
        // console.log(event, data, previewId, index,"filepreupload");
        // console.log(event, data, previewId, index, 'fileloaded');
        // console.log(data.name);
        $("#showMotionJsonA").val(data.name);
        let url = "json/" + data.name;
        PIXI_globalData.effect_A.motionJson = url;
        let id = "MotionJsonA";
        let effectName = "effect_A";
        var motionData = loadEffect.createNew();
        motionData.readMotionData(id, url, effectName)
    });




    $("#inputSpriteJsonA").fileinput(KJJsonInputStyleA); //load spritesImages jsonA

    $('#inputSpriteJsonA').on('fileloaded', function(event, data, previewId, index) {

        $("#showSpriteJsonA").val(data.name);

        let url = "sprites/" + data.name
        var imgURL = url.split('.')[0] + ".png"
        let id = "spritesImagesJsonA";
        let effectName = "effect_A";
        PIXI_globalData.effect_A.spritesJson = url;
        PIXI_globalData.effect_A.spritesImage = imgURL;
        var spritesImage = loadEffect.createNew();
        spritesImage.readSpritesData(id, url, effectName)
    });


    $("#stageDescriptJsonA").fileinput(KJJsonInputStyleA); //load spritesImages jsonA

    $('#stageDescriptJsonA').on('fileloaded', function(event, data, previewId, index) {

        $("#showStageDescriptJsonA").val(data.name);
        delete loader.resources["stageDescriptJsonA"];
        var jsonURL = "sprites/" + data.name
        PIXI_loader("stageDescriptJsonA", jsonURL);

        PIXI_globalData.effect_A.stageDescriptJsonFile = jsonURL;
        PIXI_globalData.effect_A.stageDescriptJsonData = "NONE";
        // console.log('PIXI_globalData',PIXI_globalData.inputA)
    });

    $("#inputJsonB").fileinput(KJJsonInputStyleA);

    $('#inputJsonB').on('fileloaded', function(event, data, previewId, index) {
        // console.log(event, data, previewId, index,"filepreupload");
        console.log(event, data, previewId, index, 'fileloaded');
        console.log(data.name);
        $("#showMotionJsonB").val(data.name);
    });

    $("#inputSpriteJsonB").fileinput(KJJsonInputStyleA);

    $("#inputSprtieImageB").fileinput(KJImageInputStyleA);




    $("#inputJsonC").fileinput(KJJsonInputStyleA);

    $('#inputJsonC').on('fileloaded', function(event, data, previewId, index) {
        // console.log(event, data, previewId, index,"filepreupload");
        console.log(event, data, previewId, index, 'fileloaded');
        console.log(data.name);
        $("#showMotionJsonC").val(data.name);
    });

    $("#inputSpriteJsonC").fileinput(KJJsonInputStyleA);

    $("#inputSprtieImageC").fileinput(KJImageInputStyleA);





    var openFile = function(event) {
        JsonData = ""
        var input = event.target;

        var reader = new FileReader();
        reader.onload = function() {
            var text = reader.result;
            JsonData += text
            console.log(JsonData.length);
        };
        reader.readAsText(input.files[0]);
        return JsonData
    };

    function ooo(event) {
        console.log('asdasd')
    }

</script>
<!--sliderA -->

<!--sliderB -->


</html>
