<!DOCTYPE html>
<html>

<head>
	<title>Bootstrap 模板</title>
	<!-- 引入 Bootstrap -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="scripts/bootstrap/css/bootstrap.min.css">
	<link href="scripts/bootstrap/css/fileinput.min.css" rel="stylesheet">
	<link href="scripts/bootstrap/css/fileinput-rtl.min.css" rel="stylesheet">
	<link rel="stylesheet" href="scripts/jqueryUI/jquery-ui.css">


	<script src="scripts/jqueryUI/external/jquery/jquery.js"></script>
	<script src="scripts/jqueryUI/jquery-ui.js"></script>
	<script src="scripts/pixi.min.js"></script>
	<script src="scripts/pixi_drawGraphic.js"></script>

	<script src="scripts/bootstrap/js/bootstrap.min.js"></script>

	<script src="scripts/bootstrap/js/fileinput.min.js"></script>
	<script src="scripts/pixi_effectDataTemplate.js"></script>
	<script src="scripts/pixi_UI_slideBarModule.js"></script>

</head>

<body>

	<script>
		javascript: (function() {
			var script = document.createElement('script');
			script.onload = function() {
				var stats = new Stats();
				document.body.appendChild(stats.dom);
				requestAnimationFrame(function loop() {
					stats.update();
					requestAnimationFrame(loop)
				});
			};
			script.src = '//rawgit.com/mrdoob/stats.js/master/build/stats.min.js';
			document.head.appendChild(script);
		})()


		console.log('start')
		// load setting Data json file,
		var PIXI_globalData = loadGlobalData();
		//let loader = new PIXI.loaders.Loader();

		var loader = PIXI.loader;
		var	resources = PIXI.loader.resources;
		var	Sprite = PIXI.Sprite,
			TextureCache = PIXI.utils.TextureCache,
			Rectangle = PIXI.Rectangle,
			Texture = PIXI.Texture
		
		
		var app = new PIXI.Application(800, 800, {
			backgroundColor: 0x1099bb
		});

		app.view.style.border = "3px dashed red";
		app.view.style.position = 'absolute';
		app.view.style.left = "410px";
		app.view.style.top = "5px";

		document.body.appendChild(app.view);


		var miniApp = new PIXI.Application(150, 150, {
			backgroundColor: 0x103366
		});
		miniApp.view.style.border = "2px solid brown";
		miniApp.view.style.position = 'absolute';
		miniApp.view.style.left = "200px";
		miniApp.view.style.top = "155px";

		document.body.appendChild(miniApp.view);



		//initial Data
		var container_BG = new PIXI.Container();
        
	 	container_BG.name ="container_BG";
		app.stage.addChild(container_BG);
		
        var effectList = {};
		var effectDataTemplate = {"spritesImageId":"",
								  "spriteImage":"",
									"frameList":"",
									"frameLength":"",
									"motionDataID":"",
								  	"motionDataURL":"",
								  	"motionData":"",
								  	"ppID":"",
								  	"ppCount":"",
								 };
        
        var tempAnimPlayList = {"effectContainer":"",
                "ppCount":"",
                "ppID":"",
                "motionData":"",
                "timeStart":"",
                "timeEnd":"",
                "length":""};

        var animPlayList = {};

        console.log("app.stage",app.stage);
		
		
		
		//effect Sources initial
		//var motionData_A; //pre parpicle info from maya, 由maya輸出的particle資訊，json format
		var container_A = new PIXI.Container(); //定義特效Sample容器A
		
		
		
		
		

        

		var elementResourceList_A = [];
		var renderTextureScale = 1 ; //定義renderTexture的計算尺寸縮放

        //initial Data END
		
		
		
		
		
		
		
		
		
		
		
		
        
  		function setBG(){
			//app.renderer.clear();
			//initial stage
			
			deleteAllChildrenInStage("event") //刪除所有名稱為 event的 container
			//deleteAllChildrenInStage("effect")
			//deleteAllChildrenInStage("container_BG") //刪除所有名稱為 event的 container
			app.renderer.clear();
			//app.renderer = null;
			
			app.start();
			var BGW = PIXI_globalData.BGA.width;
			var BGH = PIXI_globalData.BGA.height;
			var BGColor = "0x" + document.getElementById("colorBGA").value.split('#')[1];
			var BGAURL = document.getElementById("showBGA").value;
			var BGA_Scale = PIXI_globalData.BGA.screenScale;
			app.renderer.resize(BGW, BGH);

			app.renderer.backgroundColor = BGColor;
			//redrawRender(BG_stage);

			var background = PIXI.loader.resources.BGA_image;
			background = new Sprite(TextureCache[BGAURL]);
			background.scale.set(BGA_Scale)


			PIXI_globalData.BGA.URL = BGAURL;
			PIXI_globalData.BGA.width = BGW;
			PIXI_globalData.BGA.width = BGH;
			//var screenWidth = app.renderer.screen.width;
			//var screenHeight =app.renderer.screen.height;
			
			
            
 
			//console.log("appInitial",app);
            //deleteAllChildrenInStage();
            //console.log("stage_initial",app.stage.children.length,app.stage);
            //var keepItem = "stage_BG"
            //deleteAllChildrenInStageB(keepItem)
            
			drawGrid(container_BG,BGW,BGH); //由 pixi_drawGraphic.js繪製 背景grid
     

            for(var i=0;i<30;i++){  //測試圖型
                //addItemToNewContainer(drawTestGraphicA(BGW/2,BGH/2,BGW/2,3,3,3,3000)) ////由 pixi_drawGraphic.js繪製 大量的四邊形
            };
            

           // console.log("stage_END",app.stage.children.length,app.stage);
            /*
			app.stage.removeChildren(background);
			var BGW = PIXI_globalData.BGA.width;
			var BGH = PIXI_globalData.BGA.height;
			var BGColor = "0x" + document.getElementById("colorBGA").value.split('#')[1];
			var BGAURL = document.getElementById("showBGA").value;
			var BGA_Scale = PIXI_globalData.BGA.screenScale;;
			//var BG_stage = new Container()
			//BG_stage.interactive = true
			app.renderer.resize(BGW, BGH);

			app.renderer.backgroundColor = BGColor;
			//redrawRender(BG_stage);

			var background = resources.BGA_image;
			background = new Sprite(TextureCache[BGAURL]);
			background.scale.set(BGA_Scale)


			PIXI_globalData.BGA.URL = BGAURL;
			PIXI_globalData.BGA.width = BGW;
			PIXI_globalData.BGA.width = BGH;
			//console.log(TextureCache.BGA_image.baseTexture.width);
			//console.log("app.screen",app.screen)
			
			app.stage.addChild(background);
			// redrawRender(BG_stage)
            */
            //console.log("stage_allChildren",app.stage.children);

            
            //runAppC();
           // console.log("tempAnimPlayList",tempAnimPlayList);
           // console.log("tempAnimPlayList_container",tempAnimPlayList[ppID]);
           // console.log("animPlayList_A",aa);
            //console.log("animPlayList",animPlayList);

            //JSON.parse(animPlayList)
            //JSON.stringify(animPlayList)
            //console.log("animPlayList_A",animPlayList[effect_A]);
            //var data  = JSON.parse(animPlayList)
            //console.log("animPlayList_A",data);
            //var effectContainerSource = 
		      //function defineParticleTransformPreFrame(effectContainerSource,ppCount,ppID,motionData,frameIndex){

           // console.log("animPlayList",animPlayList[0][0],animPlayList[0][1],animPlayList[0][2],animPlayList[0][3],5);

			//console.log("stage_End, container Count,",app.stage.children.length,app.stage);

            //console.log(app.stage.children["0"]);
            //app.stage.removeChild(container_BG);
           // console.log(app.stage.children.length);
		};      

        
        function effectEventTransform(frameIndex,effectName){  //frame .app.ticker tick
            //console.log("effect stage",app.stage);
            //console.log("effect stage children",app.stage.children[frameIndex])
            //Object.keys(resources[String(id)
            
            
            
            var ppID = animPlayList[String(effectName)].ppID;
            var effecteffectContainer = animPlayList[String(effectName)].effectContainer;
            var timeLength = animPlayList[String(effectName)].length
            frameIndex = frameIndex % timeLength
            //console.log("animPlayList_target",effecteffectContainer);
            //console.log("animPlayList_target_a",animPlayList["effect_A"]["length"]);
            
            //console.log("ppID",ppID);
            
            
            for(i in ppID){
                var ppIDKey = ppID[i];
                var x = animPlayList[String(effectName)].motionData[ppIDKey].translate[frameIndex].x;
                var y = animPlayList[String(effectName)].motionData[ppIDKey].translate[frameIndex].y;
                var w = animPlayList[String(effectName)].motionData[ppIDKey].scale[frameIndex].w;
                var h = animPlayList[String(effectName)].motionData[ppIDKey].scale[frameIndex].h;
                var rotation = animPlayList[String(effectName)].motionData[ppIDKey].rotate[frameIndex].angle;
                var alpha = animPlayList[String(effectName)].motionData[ppIDKey].translate[frameIndex].trans;
                var vis = animPlayList[String(effectName)].motionData[ppIDKey].translate[frameIndex].vis;


                var effectPP = effecteffectContainer.children[i];
                effectPP.x = x;
                effectPP.y = y;
                effectPP.width = w;
                effectPP.height = h;
                effectPP.rotation = rotation;
                effectPP.alpha = alpha;

                //console.log("effectPP",i,effectPP,effectPP.width,effectPP.height,effectPP.rotation);
               // console.log("x",x,"y",y,"w",w,"h",h,"rotation",rotation,"alpha",alpha,"vis",vis);
            };
           // /effectPP.x = 
        };
        
        
		function deleteAllChildrenInStage(deleteConteinaerName) {
            app.stop();
            app.ticker.stop();
            var itemCount = app.stage.children.length;
            //console.log("show app",app);
            //console.log("totalItemCount",itemCount);
			var deleteItemCount = 0;
			var undeleteIndexList=[];
			var deleteIndexList = [];
			
			for(var i=0;i<itemCount;i++){
				var checkContainerName = app.stage.children[i].name;
				if(checkContainerName == deleteConteinaerName){
					console.log("delete Item",app.stage.children[i].name)
					//app.stage.removeChild( app.stage.children[i]);
					deleteIndexList.push(i);
				}else{
					deleteItemCount += 1;
					undeleteIndexList.push(i);
					};
				
				};
			
			for(var i in deleteIndexList){
				var j = deleteIndexList[i]
				console.log("delete index",deleteIndexList[i]);
				while(app.stage.children[j]){
					app.stage.removeChild(app.stage.children[j])
				};

			};
			//console.log("show undeleteItem",app.stage.children.length,app.stage);
		};
		
		//讀取特效sprites images json檔案
		//function 


		
		function getSpritesImagesData(id,url,effectName){
				PIXI.loader.add(id, url)
				  	.load(function(loader, resources){
						//console.log("frameList",resources[String(id)].data.frames);
						//frameList = resources[String(id)].data.frames;
						effectDataTemplate.spritesImageId = id;
						effectDataTemplate.spriteImage = url.split('.')[0] + ".png";
						effectDataTemplate.frameList = (Object.keys(resources[String(id)].data.frames));
						effectDataTemplate.frameLength = (Object.keys(resources[String(id)].data.frames).length);
						effectList[effectName] =effectDataTemplate;
						});
				console.log("effectList",effectList);	
				};
							
							
		function getMotioData(id,url,effectName){
				PIXI.loader.add(id, url)
					  .load(function(loader, resources) {
                            var motionDataKeysCount = Object.keys(resources[String(id)].data).length;
                            var motionDataKeys =  Object.keys(resources[String(id)].data)
							effectDataTemplate.motionDataID = id;
							effectDataTemplate.motionDataURL = url;
							effectDataTemplate.motionData =resources[String(id)].data;
                            var ppIDList =[];
                    
							for(var i =0;i<motionDataKeysCount;i++){
								//console.log("show motionData", i ,motionDataKeys[i],motionDataKeys[i].slice(0,3));
                                if(motionDataKeys[i].slice(0,3) == "pId"){
                                                                            //console.log("show motionData 3",motionDataKeys[i] );
                                                                         ppIDList.push(motionDataKeys[i]);
                                                                         };
							};
                            //console.log("ppidList",ppIDList);
							effectDataTemplate.ppID = ppIDList;
							effectDataTemplate.ppCount = resources[String(id)].data.metaData.particle_num;
							effectList[effectName] =effectDataTemplate;

	
					});
				console.log("effectList",effectList);

				};
		
        
        function runAppD(){
            var callEffectList = effectList["effect_A"]
            var ppID = callEffectList.ppID;
            var ppCount = callEffectList.motionData.metaData.particle_num;
            var motionData = callEffectList.motionData;
            var timeStart = callEffectList.motionData.metaData.frame_start;
            var timeEnd = callEffectList.motionData.metaData.frame_end;
            var timeLength = timeEnd - timeStart +1; 
            var tick = 0;

            defineEffectInstancer("effect_A");
            app.ticker.add(function(){
                tick += 1;
                tick = tick%timeLength;
            
                console.log("stage all build", app.stage);
                    for(var i=1;i<6;i++){
                        var effectContainer = app.stage.children[i]
                        console.log("effectContainer",i, effectContainer,effectContainer.width,effectContainer.height);
                        for (var j=0;j<ppCount;j++){
                            var ppIDKey = ppID[i];
                            var x = motionData[ppID[i]].translate[tick].x
                            var y = motionData[ppID[i]].translate[tick].y
                            effectContainer.children[j].x = x
                            effectContainer.children[j].y = y

                        }
                        //effectContainer.x =Math.random()*500;
                        //effectContainer.y =Math.random()*500;

                        //console.log("effectContainer_child",i, effectContainer.children[1]);
                    };
            });
            
            //app.ticker.add(function(){
            //     defineEffectInstancer("effect_A",tick)
            //});
        };
        
        
        function defineEffectInstancer(effectName){
            console.log("effectList",effectList);
            console.log("effectList_effect_A",effectList.effect_A);
            var callEffectList = effectList[effectName]
            var ppCount = callEffectList.motionData.metaData.particle_num;
            var ppID = callEffectList.ppID;
            var frameList =callEffectList.frameList;
            var motionData = callEffectList.motionData;
            var timeStart = callEffectList.motionData.metaData.frame_start;
            var timeEnd = callEffectList.motionData.metaData.frame_end;
            var timeLength = timeEnd - timeStart +1; 
            //var instancerCount = callEffectList.motionData.metaData.instancer_num;
            var instancerCount =5;
           // console.log("effectList_effect_A_all","ppCount",ppCount,"ppID",ppID,"frameList",frameList,"motionData",motionData,"timeLength",timeLength,"instancerCount",instancerCount);
          
            var animSpritesList = [];
			for (var i in frameList) {
                
                animSpritesList.push( PIXI.Texture.fromFrame(frameList[i]));
			};
              
            for(var i = 0; i<instancerCount ; i++){  //複製pp到instancer中
                var effectContainer = new PIXI.Container();
                effectContainer.name = "effect";

                app.stage.addChild(effectContainer);
               // effectContainer.removeChildren();
                // 設定instancer transformer
                effectContainer.x = Math.random()*500;  
                effectContainer.y = Math.random()*500; 
                effectContainer.rotation =Math.random()*300; 
                effectContainer.scale.set(0.2);
                //繪製邊界
                var graphics = new PIXI.Graphics();
                graphics.lineStyle(2, 0x0000FF, 1);
                graphics.beginFill(0xFF700B, 1);
                var sideLength = 100;
                graphics.drawRect(0, 0, sideLength, sideLength);
                graphics.endFill();
                effectContainer.addChild(graphics)
                
                //編號
                var style = new PIXI.TextStyle({
                    fontFamily: 'Arial',
                    fontSize: 25,
                    fontStyle: 'italic',
                    fontWeight: 'bold',
                    fill: ['#ffffff', '#00ff99'], // gradient
                    stroke: '#4a1850',
                    strokeThickness: 1,
                    dropShadow: true,
                    dropShadowColor: '#000000',
                    dropShadowBlur: 1,
                    dropShadowAngle: Math.PI / 1,
                    dropShadowDistance: 1,
                    wordWrap: true,
                    wordWrapWidth: 440
                });

                //var noText = new PIXI.Text(i, style);
               // noText.x = sideLength/2;
               // noText.y = sideLength/2;
               // effectContainer.addChild(noText);

                for (var j = 0; j < ppCount; j++) { // <ppCount 為每個PP都建立一個anim event，< sampleCount 則為建立樣本數量
                    var anim = new PIXI.extras.AnimatedSprite(animSpritesList);
                    anim.play();
                    effectContainer.addChild(anim);
                    
                    //設定PP transformer
                    anim.x = Math.random()*sideLength;
                    anim.y = Math.random()*sideLength;
                   // anim.scale.set(0.1);
                };
            };
            
        };
        
		
		function defineEffect(effectName){

			
			//deleteAllChildrenInStage("effect");
			var effectContainer = new PIXI.Container();
			//console.log("effectContainer start",effectContainer.children.length,effectContainer);    //會等於 ppCount，particle數量

			effectContainer.name = "effect";

			app.stage.addChild(effectContainer);
			effectContainer.removeChildren();
            
            var callEffectList = effectList[effectName]
            //console.log("Call effectList",effectList);
            //console.log("Call effectList",effectList[effectName]);

            var ppCount = callEffectList.ppCount;
            var ppID = callEffectList.ppID;
            var frameList =callEffectList.frameList;
            var motionData = callEffectList.motionData;
            var timeStart = motionData.metaData.frame_start;
            var timeEnd = motionData.metaData.frame_end;


            //console.log("ppCount",ppCount);
            //console.log("ppID",ppID);
            //console.log("frameList",frameList);
           // console.log("motionData",motionData);

            var animSpritesList = [];
			for (var i in frameList) {

                animSpritesList.push( PIXI.Texture.fromFrame(frameList[i]));
			};
			//console.log("animSpritesList",animSpritesList);
            for (var i = 0; i < ppCount; i++) { // <ppCount 為每個PP都建立一個anim event，< sampleCount 則為建立樣本數量
				//var stageB = new container()
				var anim = new PIXI.extras.AnimatedSprite(animSpritesList);
               // console.log("anim",anim);
                //anim.animationSpeed = frameSpeed;
                //anim.rotation = spritesRotation;
               // anim.gotoAndPlay = Math.random()*spritesFrameOffset;
                //anim.alpha = spritesTrans;
                //anim.scale.set(1);
				//anim.anchor.set(Math.random(0.4,0.6));

				//console.log("container.width",container.width);

				anim.play();
				effectContainer.addChild(anim);

			};
            
            tempAnimPlayList.effectContainer = effectContainer,
            tempAnimPlayList.ppCount = ppCount,
            tempAnimPlayList.ppID = ppID,
            tempAnimPlayList.motionData = motionData,
            tempAnimPlayList.timeStart = timeStart,
            tempAnimPlayList.timeEnd = timeEnd,
            tempAnimPlayList.length = (timeEnd-timeStart+1);
            animPlayList["effect_A"]= tempAnimPlayList;
            //var tempAnimPlayList =[];

           // tempAnimPlayList.effectName.push(ppCount);
            //tempAnimPlayList.effectName.push(ppID);
            //tempAnimPlayList.effectName.push(motionData);

			//console.log("effectContainer end",effectContainer.children.length,effectContainer);    //會等於 ppCount，particle數量
			//defineParticleTransformPreFrame(effectContainer,ppCount,ppID,motionData,1);  //為容器中每個particle 定義transform 資訊
            //console.log("animPlayList",animPlayList);
            //freezeTransform(effectContainer,400,400);
		};
		


        
        function runAppC(){
            var tick = 0;
            app.ticker.add(function(){
                tick += 1;
               // var timeLengthA = 
                //tickA = tick % animPlayList[0][6];
               // console.log("tick",tick);
                //console.log("animPlayList",animPlayList[0][0],animPlayList[0][1],animPlayList[0][2],animPlayList[0][3],tick);
                //defineParticleTransformPreFrame(animPlayList[0][0],animPlayList[0][1],animPlayList[0][2],animPlayList[0][3],tick);
                effectEventTransform(tick,"effect_A");
                
            });
        };
        
		
		function defineParticleTransformPreFrame(effectContainerSource,ppCount,ppID,motionData,frameIndex){
			console.log("effectContainerSource",effectContainerSource);
            console.log("motionData",motionData);
	
			for(i in ppID){
                var ppIDKey = ppID[i];
                var x = motionData[ppID[i]].translate[frameIndex].x
                var y = motionData[ppID[i]].translate[frameIndex].y
                var vis = motionData[ppID[i]].translate[frameIndex].vis
                var index = motionData[ppID[i]].translate/[frameIndex].index
                //console.log("PPID",motionData,ppID[i],typeof ppID[i],motionData[ppID[i]]);
                console.log("x",x,"y",y,"vis",vis,"index","index");

                //var x=
                
				effectContainerSource.children[i].x = Math.random()*300;
				effectContainerSource.children[i].y = Math.random()*300;

				//console.log()
			};
		};
		


		$(document).ready(function() {
			$("#testAll").click(function() {
				console.log("push TestA");
				//console.log("screenSize",app.renderer.screen.width,app.renderer.screen.height);
				//console.log("loader",PIXI.loader);
				setBG();
                console.log("stage start",app.stage);
                runAppD();
                //defineEffect("effect_A");
                //console.log("animPlayList",animPlayList);
                //effectEventTransform(0,"effect_A");
                //runAppC()
                //var emptyContainer = new PIXI.Container();
               // emptyContainer.name = "notUsed";
                //app.stage.addChild(emptyContainer);
                
				//app.renderer.clear();
				//var frameListA = getEffectData("pp","sprites/color_circle.json");
				//console.log("frameListA",frameListA);
				//var frameListA = [];
				//console.log("effectList",effectList);
                

				/*;
				app.ticker.stop();
				var tick = 0;
                console.log("PIXI_globalData",PIXI_globalData);
				console.log("children", app.stage.children.length);


				console.log("app", app);
				console.log("app.stage", app.stage);
				

				console.log('resources_spritesImagesJson', resources.spritesImagesJsonA);
				frameListA = Object.keys(resources.spritesImagesJsonA.data.frames);
				motionData_A = resources["MotionJsonA"];
                var inputIndex = "inputA"
				build_elementResourceList(frameListA, motionData_A, container_A,inputIndex);
				console.log("container_A",container_A);
				var rtA = referFromElementResource(container_A,motionData_A);
				runApp(container_A,motionData_A,rtA);
				*/
			});
			$("#resetA").click(function() {
				console.log("resetA")

			});
			$("#applyA").click(function() {
				
				console.log(PIXI_globalData.inputA.spritesImageMode, typeof PIXI_globalData.inputA.spritesImageMode);
				//frameListA = Object.keys(resources.spritesImagesJsonA.data.frames);
				if (PIXI_globalData.inputA.spritesImageMode == 0) {
					console.log("singal frame");
					var stillImageA = document.getElementById("stillImageNameA").value;
					PIXI_globalData.inputA.stillImageName = stillImageA;

					appendListInfoIntoTextarea(frameListA);

					checkImageInSpritesSheet(stillImageA, frameListA);
				} else {
					console.log("sequence frame");
					PIXI_globalData.inputA.stillImageName = "sequence images";
					var spritesSpeed = PIXI_globalData.inputA.adjust.frameSpeed;
					console.log(spritesSpeed)
					buildSpritesSheetSequence(frameListA, spritesSpeed);

				};

			});
		});
		var renderEvent = []

		function PIXI_loader(id, url) {

			//app.stop();
			//delete loader.resources[id];
			loader
				.add(id, url)
				.load(setup);

			function setup() {
				console.log("loading " + id)

			};
			//app.start();

		};



		function redrawRender(containID) {
			app.render(containID)
		};

        function addItemToNewContainer(event){
            var instancerContainer = new PIXI.Container();
			instancerContainer.name = "event"
           // var screenWidth = app.renderer.screen.height;
           // var screenHeight = app.renderer.screen.width;
            instancerContainer.addChild(event);
            //instancerContainer.pivot.x = -100//instancerContainer.width / 2;
           // instancerContainer.pivot.y =-100//instancerContainer.height / 2;
            //console.log("instancerContainer.width",instancerContainer.width);
           // console.log("instancerContainer.height",instancerContainer.height);
            //console.log("instancerContainer.pivot.x",instancerContainer.pivot.x);

            //instancerContainer.pivot.x =screenWidth/2 + instancerContainer.width/2  //freeze pivot and move to center
           // instancerContainer.pivot.y =screenHeight/2 + instancerContainer.height/2
           // instancerContainer.x = screenWidth/2;
           // instancerContainer.y = screenHeight/2;
           // instancerContainer.alpha = 0.1
           // instancerContainer.x =200;
            app.stage.addChild(instancerContainer);
        };
        
        
        function createBaseCanvas(){
              
        };


        
        
        function freezeTransform(item,screenWidth,screenHeight){
            item.pivot.x =screenWidth/2 + item.width/2  //freeze pivot and move to center
            item.pivot.y =screenHeight/2 + item.height/2
            item.x = screenWidth/2;
            item.y = screenHeight/2;
            
        };
        
        function showMessage(){
            var container_message = new PIXI.Container();
            container_message.name = "container_message"
           // console.log("message")
            var stageCount = app.stage.children.length;
            var styleC = new PIXI.TextStyle({
                
                fontFamily: 'Arial',
                fontSize: 20,
                fill: ['#ffffff', '#00ff99'], // gradient
                stroke: '#4a1850',
                strokeThickness: 1,
                dropShadow: true,
                dropShadowColor: '#000000',
                dropShadowBlur: 1,
                dropShadowAngle: Math.PI / 6,
                dropShadowDistance: 1,
                wordWrap: true,
                wordWrapWidth: 440 });
            
            var stageCountText = new PIXI.Text("stageCount : "+stageCount ,styleC);
            stageCountText.x = 500;
            stageCountText.y = 30;
            container_message.addChild(stageCountText);
            app.stage.addChild(container_message);
            app.stage.removeChild("container_message")
            //console.log("message end")


        };
            
        function RunAppB(){
            var tick = 0;
            app.ticker.start();

            var stageChildrenCount= app.stage.children.length;
                        
            var screenWidth = app.renderer.screen.width;
            var screenHeight = app.renderer.screen.height;
            
            app.ticker.add(function(){
                tick += 0.1;
               // showMessage()
                for(var i =1 ; i<stageChildrenCount;i++){
                    var getContainer = app.stage.children[i]
                    freezeTransform(getContainer,screenWidth,screenHeight);
                    defineParticleTransformPreFrame(effectContainerSource,ppCount,ppID,motionData)
                   // getContainer.pivot.x =screenWidth/2//+squareWidth/2;    //freeze pivot and move to center
                  //  getContainer.pivot.y =screenHeight/2//+squareWidth/2;
                  //  getContainer.x = screenWidth/2;
                  //  getContainer.y = screenHeight/2;
                    //app.stage.children[i].x = 100;
                    //app.stage.children[i].y = Math.random()*100 ;
                    //app.stage.children[i].pivot.x = app.stage.children[i].width / 2;
                   // app.stage.children[i].pivot.y = app.stage.children[i].height / 2;
                   // app.stage.children[i].anchor= 1;
                    //app.stage.children[i].pivot.x = 400;
                   // app.stage.children[i].pivot.y = 400;
                   // getContainer.x = Math.random()*100;
                   // getContainer.y = Math.random()*100;
                    
                    //defineParticleTransformPreFrame(effectContainer,ppCount,ppID,motionData,1)
                    //getContainer.rotation = tick;
                    //getContainer.scale.set((tick*0.1)%1);
                    //app.stage.children[i].rotation = Math.random()*360;
                    };
                });
            };

		function appendListInfoIntoTextarea(dataList) {
			//$("#info").val("images:");
			var frameList = ""
			for (var i in dataList) {
				frameList += (dataList[i] + " \n");
				//$("#info").append(dataList[i]);
			};
			//console.log("frameList",frameList);
			$("#info").val(frameList)
		};

		function checkImageInSpritesSheet(spriteName, spritesList) {
			var checkExist = jQuery.inArray(spriteName, spritesList);
			if (checkExist == -1) {
				console.log("檔案不存在(sprite Image)");
				document.getElementById("stillImageNameA").value = "檔案不存在(sprite Image)";
			} else {
				console.log(checkExist, spritesList[checkExist]);
				var sprite = addSprite(spriteName);
				console.log("sprite", sprite);
				app.stage.addChild(sprite);

			};
		};

		//創建anim Sprites event List  , animSpritesList(將序列的sprties images建立成一個連續撥放的list),anim(使用PIXI.extras.AnimatedSprite將 animSpritesList建立為PIXI的動態撥放事件)

		function buildSpritesSheetSequence(frameList, spritesSpeed) {
			var animSpritesList = []

			for (var i in frameList) {
				//var imageItem = Sprite.fromFrame(spritesList[i]);
				var imageItem = Texture.fromFrame(frameList[i])
				//console.log("imageItem",imageItem);
				animSpritesList.push(imageItem)
			};
			var sampleAnim = new PIXI.extras.AnimatedSprite(animSpritesList);
			//console.log("anim",anim)
			sampleAnim.animationSpeed = spritesSpeed;
			//check anim scale ,width and height
			if (sampleAnim.width >= sampleAnim.height) {
				var animPreViewScale = (miniApp.screen.width / sampleAnim.width);
			} else {
				var animPreViewScale = (miniApp.screen.width / sampleAnim.height)
			};


			sampleAnim.scale.set(animPreViewScale);
			sampleAnim.anchor.set(0.5);

			sampleAnim.x = miniApp.screen.width / 2;
			sampleAnim.y = miniApp.screen.width / 2;
			sampleAnim.play();
			miniApp.stage.removeChild(sampleAnim)
			miniApp.stage.addChild(sampleAnim)
		};

		// 建立PP的樣本素材事件
		function build_elementResourceList(frameList, motionData, container,inputIndex) {
			var ppData = motionData.data;
			console.log("ppData", ppData);
			var ppID = Object.keys(ppData);
			var ppCount = ppID.length -2 ; //扣除 metaData ，instancer

            var frameSpeed = PIXI_globalData[inputIndex].adjust.frameSpeed;
            var spritesSizeRandom = PIXI_globalData[inputIndex].adjust.spritesSizeRandom;

            var spritesFrameOffset = PIXI_globalData[inputIndex].adjust.spritesFrameOffset;

            
            
			var animSpritesList = []
			for (var i in frameList) {
				var imageItem = Texture.fromFrame(frameList[i])
				//console.log("imageItem",imageItem);
				animSpritesList.push(imageItem)
			};

			console.log("app.screen",app.screen)

			container.pivot.x = motionData.data.metaData.width/2;
			container.pivot.y = motionData.data.metaData.height/2;
			container.x = (motionData.data.metaData.width*renderTextureScale)/2;//app.screen.width/2;
			container.y = (motionData.data.metaData.width*renderTextureScale)/2;//app.screen.height/2;
			container.scale.set(renderTextureScale); //設定renderTexture 的scale
			console.log("pivot",container.pivot.x,container.pivot.y,container.x,container.y)

		
			//app.stage.addChild(container);  //reference 原始素材是否加入顯示，測試時可以開啟

			var ppMulti =5
			for (var i = 0; i < ppCount; i++) { // <ppCount 為每個PP都建立一個anim event，< sampleCount 則為建立樣本數量
				//var stageB = new container()
				var anim = new PIXI.extras.AnimatedSprite(animSpritesList);
                
                anim.animationSpeed = frameSpeed;
                //anim.rotation = spritesRotation;
                anim.gotoAndPlay = Math.random()*spritesFrameOffset;
                //anim.alpha = spritesTrans;
                //anim.scale.set(1);
				//anim.anchor.set(Math.random(0.4,0.6));

				//console.log("container.width",container.width);

				anim.play()
				container.addChild(anim);

			};


				



		};
		


		//refer from elementResource and build instance to specific position
		// 使用  renderTexture 建立instance ，當contain 更新， instance也會更新
        //定義 instancer在 canvas中的 position， rotation, scale，timeOffset
	
		function referFromElementResource(container,motionData){

			var instancerData = motionData.data.instancer
            var instancerCount =  motionData.data.metaData.instancer_num
            var instancerID = Object.keys(instancerData);
            //console.log("instancerData",instancerData,"instancerCount",instancerCount);
			var renderTextureRes = motionData.data.metaData.width * renderTextureScale;
			console.log("renderTextureRes",renderTextureRes);
			var brt = new PIXI.BaseRenderTexture(renderTextureRes, renderTextureRes);//, PIXI.SCALE_MODES.LINEAR, 1
			var rt = new PIXI.RenderTexture(brt);
            
			for (var j = 0; j <instancerCount; j++) { // j 為複製的數量
				var sprite = new PIXI.Sprite(rt);
				console.log("renderTextureScaleBB",renderTextureScale)
				//sprite.anchor.set(0.5)
                sprite.scale.set((1/renderTextureScale));// (1/renderTextureScale) 還原成原素材尺寸
				instancerKey = "instancer_" +String(j);
				//sprite.pivot.x = renderTextureRes/2;
				//sprite.pivot.y = renderTextureRes/2;
                //sprite.x =300; //instancerData[instancerKey].translate[1].x;
                //sprite.y = 300;//instancerData[instancerKey].translate[1].y;
				//console.log("instancePossition",eventTick,app.stage.children[c].x,app.stage.children[c].y)

				app.stage.addChild(sprite);
				//sprite.rotation = Math.random*360;


			};
            
            
			//app.renderer.render(container, rt);
			return rt;
		};

        
			//var ppCount = 100
		
		function runApp(container,motionData,rt){
            console.log("stage",app.stage.children);
			console.log("rt",rt);

            //console.log("stageChild0",app.stage.children[0]);
			var ppData = motionData.data;
			var ppID = Object.keys(ppData);
			var ppCount = ppID.length-2; //扣除 instancer 與 mataData
			//var ppKey = 'pId_' + String(pp);
			var timeLength = ppData[ppID[0]].translate.length;
			var instancerData = motionData.data.instancer
            var instancerID = Object.keys(instancerData);
            var instancerCount =  motionData.data.metaData.instancer_num

            var tick = 0
           
			app.ticker.stop();
			//deleteAllChildrenInStage();
			console.log(app.ticker.FPS);
			app.ticker.start();
			app.ticker.add(function() {
                var effectSpeed = PIXI_globalData.inputA.adjust.speed;

				tick += effectSpeed;
                eventTick = parseInt(tick);
                eventTick= eventTick %timeLength
                var inputA= "inputA"
				defineInstanceTransform(instancerData,instancerCount,eventTick);
				runContainMotion(container,instancerData,instancerCount,ppData,ppCount,timeLength,eventTick,inputA)
				//container += 50;
				app.renderer.render(container, rt);
			});
		};
		
		//定義instancer的資訊
		function defineInstanceTransform(instancerData,instancerCount,eventTick){// i =0,app.stage.children[0]是背景
			for(var i =0;i<instancerCount;i++){
				instancerKey = "instancer_" +String(i);
                console.log("instancerCount",instancerCount)
				console.log("stageCount",app.stage.children[i]);
				
				app.stage.children[i].x = instancerData[instancerKey].translate[eventTick].x+512;	
				app.stage.children[i].y = instancerData[instancerKey].translate[eventTick].y+512;
				app.stage.children[i].rotation = ((instancerData[instancerKey].rotate[eventTick].angle)/57.3);
				app.stage.children[i].scale.set(instancerData[instancerKey].scale[eventTick].h);
				console.log("i",i,"x",app.stage.children[i].x,"y",app.stage.children[i].y,"rotation",app.stage.children[i].rotation);
			};	
		};
		
		
		
		function runContainMotion(container,instancerData,instancerCount,ppData,ppCount,timeLength,eventTick,inputIndex){

            var spritesSize = PIXI_globalData[inputIndex].adjust.spritesSize;
            var effectSpeed = PIXI_globalData.inputA.adjust.speed;

            var frameSpeed = PIXI_globalData[inputIndex].adjust.frameSpeed;
            var spritesSizeRandom = PIXI_globalData[inputIndex].adjust.spritesSizeRandom;
            var spritesRotation = PIXI_globalData[inputIndex].adjust.spritesRotation;
            var spritesRotationRandom = PIXI_globalData[inputIndex].adjust.spritesRotationRandom;
            var spritesTrans = PIXI_globalData[inputIndex].adjust.spritesTrans;
            var spritesBlur = PIXI_globalData[inputIndex].adjust.spritesBlur;
            //console.log("stage",app.stage.children);
            //console.log("stageChild0",app.stage.children[0]);
            //app.stage.children[0].x += eventTick;
			/*
            for(var c =0;c<instancerCount;c++){ //instancerCount
				instancerKey = "instancer_" +String(c);
              //  app.stage.children[c].x = instancerData[instancerKey].translate[eventTick].x-512;
              //  app.stage.children[c].y = instancerData[instancerKey].translate[eventTick].y-512;
				container.x =instancerData[instancerKey].translate[eventTick].x
				container.y =instancerData[instancerKey].translate[eventTick].y
				
				console.log("container",container);
				console.log("instancePossition",app.stage.children[c].x,app.stage.children[c].y,app.stage.children[c].pivot.x,app.stage.children[c].pivot.y)
            };
			*/
			for (var pp = 0; pp < ppCount; pp++) {

				var ppKey = 'pId_' + String(pp);

				var x = ppData[ppKey].translate[eventTick].x;
				var y = ppData[ppKey].translate[eventTick].y;
				var width = ppData[ppKey].scale[eventTick].w;
				var height = ppData[ppKey].scale[eventTick].h;
				var trans = ppData[ppKey].translate[eventTick].trans;
				var rotation = (ppData[ppKey].rotate[eventTick].angle);

				container.children[pp].x = x;
				container.children[pp].y = y;
				container.children[pp].width = width * spritesSize;
				container.children[pp].height = height * spritesSize;
				container.children[pp].alpha = trans * spritesTrans;

				container.children[pp].rotation = -((rotation / 57.3));

			};
		};
		
		
		// 將素材依據 motion data，放入對應位置，並調整編輯



		function addSprite(imageName) {
			var imageItem = Sprite.fromFrame(imageName);
			//console.log(imageItem);
			return imageItem;
		};

	</script>


</body>

<body>

	<div class="container-fluid">

		<div class="row-fluid">

			<div class="col-xs-6 span4" style="background-color: rgb(230,230,200);padding:3px;margin:1px;width:380px; ">

				<div class="row-fluid" id="inputBG_Dialog" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;height: 300px">
					<div>
						<button class="btn btn-warning" id="testAll" style="width:100px;font-size:16px;padding-left: 3px;line-height: 25px;margin-top: 5px">testA</button>
					</div>
					<div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


						<button class="btn btn-info dropdown-toggle" type="button" id="screenModeButton" data-toggle="dropdown" style="margin-left: -2px; width: 280px;height: 30px;line-height: 23px; padding: 1px;text-align: center;">版型選擇
                            <span class="caret"></span></button>
						<ul class="dropdown-menu" role="presentation" aria-labelledby="screenModeButton" id="screenMode_databox">
							<li role="presentation"><a role="menuitem" tabindex="0" href="#">1. 1920 1080 , scale=1 solt game h5</a></li>
							<li role="presentation"><a role="menuitem" tabindex="1" href="#">2. 960 540 , scale=0.5 solt game h5</a></li>
							<li role="presentation"><a role="menuitem" tabindex="1" href="#">3. 1280 720 , scale=1 test A</a></li>
							<li role="presentation"><a role="menuitem" tabindex="1" href="#">4. 1024 1024 , scale=1 test B</a></li>
							<li role="presentation"><a role="menuitem" tabindex="1" href="#">5. 1000 700 , scale=1 slot Game flash</a></li>
							<li role="presentation"><a role="menuitem" tabindex="1" href="#">6. 800 800 , scale=1 test D</a></li>
							<li role="presentation"><a role="menuitem" tabindex="1" href="#">7. 400 400 , scale=1 test E</a></li>
							<li role="presentation"><a role="menuitem" tabindex="0" href="#">1. 2048 2048 , scale=1 solt game h5</a></li>

							<li role="presentation" class="divider"></li>
							<li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
						</ul>

					</div>

					<div class="col-xs-3 span2" style="width:300px;font-size: 14px">
						<input type="file" id="inputBGA">
						<input type="text" id="showBGA" value="選取背景圖檔" style="width:260px;height: 16px; color:darkcyan;text-align:center;margin: 2px;line-height: 20px;"><br>


						<span>BG color: </span><input type="color" id="colorBGA" value="#11aaaa" style="width:50px;height: 20px; margin-top: 5px;color:darkcyan;padding: 1px;text-align:center;"><br>
						<button id="BGA_apply" class="btn btn-success" onclick="setBG()" style="height: 25px;width:100px;margin-top: 5px;">APPLY</button>



					</div>
				</div>
				<div id="infoBox" style="background-color:rgb(250,250,250);padding:5px;width:360px;border-radius: 10px;">
					<textarea id="info" style="width:340px;height: 50px;margin: 0px"></textarea>

				</div>
				<div style=" padding: 5px;letter-spacing: 1px;">
					<!-- Right  inputDataA-->

					<button id="input_a" class="btn btn-success">素材 A</button><small class="text-info" style=" padding-left: 10px;">點選展開 </small>


					<div id="inputDataA">

						<div id="inputADialog_1" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;">
							<p style=" padding-left: 10px; ">圖檔模式:</p>
							<form action="">
								<div class="container-fluid" style=" padding-left: 15px;">
									<input type="radio" name="optionsRadiosinline" id="optionsRadiosA1" value="option1"> 單張圖:
									<input type="text" id="stillImageNameA" class="text-info" style="width:180px;padding:0px;margin-bottom: -2px;font-size: 12px;color:darkgray">
									<button id="inputExtA" class="btn btn-info" style="line-height: 10px;width: 50px; font-size: 10px">展開</button><br>
									<input type="radio" name="optionsRadiosinline" id="optionsRadiosA2" value="option2" checked> 連續圖
								</div>
							</form>
							<div class="row" style=" padding-left: 5px; margin: 5px;width:350; ">
								<div class="col-xs-3 span2" style="width:110px;line-height: 35px;">
									<input type="file" id="inputJsonA">
									<input type="file" id="inputSpriteJsonA">
									<input type="file" id="stageDescriptJsonA">

								</div>
								<div class="col-xs-3 span5" style="width:200px">
									<input type="text" id="showMotionJsonA" value="選取動態JSON檔案" style="width:200px;margin-top: 4px;color:darkcyan;">
									<input type="text" id="showSpriteJsonA" value="選取Sprites JSON檔案" style="width:200px;margin-top: -6px;color:darkcyan;">
									<input type="text" id="showStageDescriptJsonA" value="選取stage描述JSON檔案" style="width:200px;margin-top: -4px;color:darkcyan;">

								</div>
							</div>


							<div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


								<button class="btn btn-warning dropdown-toggle" type="button" id="menuA_blendMode" data-toggle="dropdown" style="width: 120px;padding: 1px;">混色模式
                            <span class="caret"></span></button><text id="blendModeTextA" style="padding-left:15px;color:darkcyan ">選擇混色模式</text><br>
								<ul class="dropdown-menu" role="menu" aria-labelledby="menuA_blendMode" id="databoxA">
									<li role="presentation"><a role="menuitem" tabindex="0" href="#">NORMAL</a></li>
									<li role="presentation"><a role="menuitem" tabindex="1" href="#">ADD</a></li>
									<li role="presentation"><a role="menuitem" tabindex="2" href="#">MULTIPKY</a></li>
									<li role="presentation"><a role="menuitem" tabindex="3" href="#">SCREEN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="4" href="#">OVERLAY</a></li>
									<li role="presentation"><a role="menuitem" tabindex="5" href="#">LIGHTEN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="6" href="#">COLOR_DODGE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="7" href="#">COLOR_BURN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="8" href="#">HARD_LIGHT</a></li>
									<li role="presentation"><a role="menuitem" tabindex="9" href="#">SOFT_LIGHT</a></li>
									<li role="presentation"><a role="menuitem" tabindex="10" href="#">DIFFERENCE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="11" href="#">EXCLUSION</a></li>
									<li role="presentation"><a role="menuitem" tabindex="12" href="#">HUE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="13" href="#">SATURATION</a></li>
									<li role="presentation"><a role="menuitem" tabindex="14" href="#">COLOR</a></li>
									<li role="presentation"><a role="menuitem" tabindex="15" href="#">LUMINOSITY</a></li>
									<li role="presentation" class="divider"></li>
									<li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
								</ul>

							</div>

						</div>

						<div class="row" id="inputADialog_2" style="background-color:rgb(250,250,250);padding:0px;width:360px;margin:5px;border-radius: 10px;">
							<h5 style="padding-left:12px">細部調整</h5>
							<div class="col-xs-6 span4" style="font-size: 12px ;margin-left: 5px;line-height: 23px;margin-top: 12px">
								speed <br>
								<line></line>
								frame Speed <br> Sprites Size <br> <span style="font-size: 12px"> random Size </span> <br> Sprites Rotate <br>rotate Random<br> frame Offset<br>Sprite Trans <br>Sprite Blur <br>
							</div>
							<div class="col-xs-6 span2" style="margin: 5px; line-height: 23px;">
								<div id="speedSliderA" style="margin:10px;width:200px;height: ">
									<!-- slide bar -->

									<div id="speedSliderA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="frameSpeedA" style="margin:10px;width:200px">
									<div id="frameSpeedA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpritesSizeA" style="margin:10px;width:200px">
									<div id="SpritesSizeA-handle" class="ui-slider-handle " style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpritesSizeRandomA" style="margin:10px;width:200px">
									<div id="SpritesSizeRandomA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpritesRotateA" style="margin:10px;width:200px">
									<div id="SpritesRotateA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpritesRotateRandomA" style="margin:10px;width:200px">
									<div id="SpritesRotateRandomA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpritesframeOffsetA" style="margin:10px;width:200px">
									<div id="SpritesframeOffsetA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpriteTransA" style="margin:10px;width:200px">
									<div id="SpriteTransA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<div id="SpriteBlurA" style="margin:10px;width:200px">
									<div id="SpriteBlurA-handle" class="ui-slider-handle" style="border-radius: 5px;width:25px;text-align: center;"></div>
								</div>
								<button id="resetA" type="button" class="btn btn-info" style="height: 23px;width:100px;">RESET</button>
								<button id="applyA" type="button" class="btn btn-success" style="height: 23px;width:100px;margin-top: 5px;">APPLY</button>

							</div>
						</div>

					</div>

				</div>
				<div style=" padding: 5px;letter-spacing: 1px;">
					<!-- Right  inputDataB-->

					<button id="inputB" class="btn btn-success">素材 B</button><small class="text-info" style=" padding-left: 10px;">點選展開 </small>


					<div id="inputDataB">

						<div id="inputBDialog_1" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;">
							<p style=" padding-left: 10px; ">圖檔模式:</p>
							<form action="">
								<div class="container-fluid" style=" padding-left: 3px;">
									<input type="radio" name="optionsRadiosinline" id="optionsRadiosB1" value="option1"> 單張圖
									<input type="radio" name="optionsRadiosinline" id="optionsRadiosB2" value="option2" checked> 連續圖
								</div>
							</form>
							<div class="row" style=" padding-left: 5px; margin: 5px;width:350; ">
								<div class="col-xs-3 span2" style="width:110px;line-height: 35px;">
									<input type="file" id="inputJsonB">
									<input type="file" id="inputSpriteJsonB">
									<input type="file" id="inputSprtieImageB">

								</div>
								<div class="col-xs-3 span5" style="width:200px">
									<input type="text" id="showMotionJsonB" value="選取動態JSON檔案" style="width:200px;margin-top: 4px;color:darkcyan;">
									<input type="text" id="showSpriteJsonB" value="選取Sprites JSON檔案" style="width:200px;margin-top: -6px;color:darkcyan;">
									<input type="text" id="showSpriteImageB" value="選取Sprite Image檔案" style="width:200px;margin-top: -4px;color:darkcyan;">

								</div>
							</div>


							<div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


								<button class="btn btn-warning dropdown-toggle" type="button" id="menuB_blendMode" data-toggle="dropdown" style="width: 120px;padding: 1px;">混色模式
                            <span class="caret"></span></button><text id="blendModeTextB" style="padding-left:15px;color:darkcyan;">選擇混色模式</text><br>
								<ul class="dropdown-menu" role="menu" aria-labelledby="menuB_blendMode">
									<li role="presentation"><a role="menuitem" tabindex="0" href="#">NORMAL</a></li>
									<li role="presentation"><a role="menuitem" tabindex="1" href="#">ADD</a></li>
									<li role="presentation"><a role="menuitem" tabindex="2" href="#">MULTIPKY</a></li>
									<li role="presentation"><a role="menuitem" tabindex="3" href="#">SCREEN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="4" href="#">OVERLAY</a></li>
									<li role="presentation"><a role="menuitem" tabindex="5" href="#">LIGHTEN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="6" href="#">COLOR_DODGE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="7" href="#">COLOR_BURN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="8" href="#">HARD_LIGHT</a></li>
									<li role="presentation"><a role="menuitem" tabindex="9" href="#">SOFT_LIGHT</a></li>
									<li role="presentation"><a role="menuitem" tabindex="10" href="#">DIFFERENCE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="11" href="#">EXCLUSION</a></li>
									<li role="presentation"><a role="menuitem" tabindex="12" href="#">HUE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="13" href="#">SATURATION</a></li>
									<li role="presentation"><a role="menuitem" tabindex="14" href="#">COLOR</a></li>
									<li role="presentation"><a role="menuitem" tabindex="15" href="#">LUMINOSITY</a></li>
									<li role="presentation" class="divider"></li>
									<li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
								</ul>

							</div>
						</div>
						<div class="row" id="inputBDialog_2" style="background-color:rgb(250,250,250);padding:0px;width:350px;margin:5px;border-radius: 10px;">
							<h5 style="padding-left:12px">細部調整</h5>
							<div class="col-xs-6 span4" style="font-size: 12px ;margin-left: 5px;line-height: 22px;margin-top: 12px">
								speed <br>
								<line></line>
								frame Speed <br> Sprites Size <br> <span style="font-size: 12px"> random Size </span> <br> Sprites Rotate <br> Sprite Blur <br>
							</div>
							<div class="col-xs-6 span2" style="margin: 5px">
								<div id="speedSliderB" style="margin:10px;width:200px;">
									<!-- slide bar -->

									<div id="speedSliderB-handle" class="ui-slider-handle"></div>
								</div>
								<div id="frameSpeedB" style="margin:10px;width:200px">
									<div id="frameSpeedB-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpritesSizeB" style="margin:10px;width:200px">
									<div id="SpritesSizeB-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpritesSizeRandomB" style="margin:10px;width:200px">
									<div id="SpritesSizeRandomB-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpritesRotateB" style="margin:10px;width:200px">
									<div id="SpritesRotateB-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpriteBlurB" style="margin:10px;width:200px">
									<div id="SpriteBlurB-handle" class="ui-slider-handle"></div>
								</div>
								<button id="resetB" type="button" class="btn btn-info" style="height: 25px;width:100px;">RESET</button>
								<button id="applyB" type="button" class="btn btn-success" style="height: 25px;width:100px;margin-top: 5px;">APPLY</button>

							</div>
						</div>

					</div>

				</div>
				<div style=" padding: 5px;letter-spacing: 1px;">
					<!-- Right  inputDataC-->

					<button id="inputC" class="btn btn-success">素材 C</button><small class="text-info" style=" padding-left: 10px;">點選展開 </small>


					<div id="inputDataC">

						<div id="inputCDialog_1" style="background-color:rgb(250,250,250);padding:5px;width:350px;margin:5px;border-radius: 10px;">
							<p style=" padding-left: 10px; ">圖檔模式:</p>
							<form action="">
								<div class="container-fluid" style=" padding-left: 3px;">
									<input type="radio" name="optionsRadiosinline" id="optionsRadiosC1" value="option1"> 單張圖
									<input type="radio" name="optionsRadiosinline" id="optionsRadiosC2" value="option2" checked> 連續圖
								</div>
							</form>
							<div class="row" style=" padding-left: 5px; margin: 5px;width:350; ">
								<div class="col-xs-3 span2" style="width:110px;line-height: 35px;">
									<input type="file" id="inputJsonC">
									<input type="file" id="inputSpriteJsonC">
									<input type="file" id="inputSprtieImageC">

								</div>
								<div class="col-xs-3 span5" style="width:200px">
									<input type="text" id="showMotionJsonC" value="選取動態JSON檔案" style="width:200px;margin-top: 4px;color:darkcyan;">
									<input type="text" id="showSpriteJsonC" value="選取Sprites JSON檔案" style="width:200px;margin-top: -6px;color:darkcyan;">
									<input type="text" id="showSpriteImageC" value="選取Sprite Image檔案" style="width:200px;margin-top: -4px;color:darkcyan;">

								</div>
							</div>


							<div class="dropdown" style=" padding-left: 10px;  line-height: 35px;">


								<button class="btn btn-warning dropdown-toggle" type="button" id="menuC_blendMode" data-toggle="dropdown" style="width: 120px;padding: 1px;">混色模式
                            <span class="caret"></span></button><text id="blendModeTextC" style="padding-left:15px;color:darkcyan ">選擇混色模式</text><br>
								<ul class="dropdown-menu" role="menu" aria-labelledby="menuC_blendMode">
									<li role="presentation"><a role="menuitem" tabindex="0" href="#">NORMAL</a></li>
									<li role="presentation"><a role="menuitem" tabindex="1" href="#">ADD</a></li>
									<li role="presentation"><a role="menuitem" tabindex="2" href="#">MULTIPKY</a></li>
									<li role="presentation"><a role="menuitem" tabindex="3" href="#">SCREEN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="4" href="#">OVERLAY</a></li>
									<li role="presentation"><a role="menuitem" tabindex="5" href="#">LIGHTEN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="6" href="#">COLOR_DODGE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="7" href="#">COLOR_BURN</a></li>
									<li role="presentation"><a role="menuitem" tabindex="8" href="#">HARD_LIGHT</a></li>
									<li role="presentation"><a role="menuitem" tabindex="9" href="#">SOFT_LIGHT</a></li>
									<li role="presentation"><a role="menuitem" tabindex="10" href="#">DIFFERENCE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="11" href="#">EXCLUSION</a></li>
									<li role="presentation"><a role="menuitem" tabindex="12" href="#">HUE</a></li>
									<li role="presentation"><a role="menuitem" tabindex="13" href="#">SATURATION</a></li>
									<li role="presentation"><a role="menuitem" tabindex="14" href="#">COLOR</a></li>
									<li role="presentation"><a role="menuitem" tabindex="15" href="#">LUMINOSITY</a></li>
									<li role="presentation" class="divider"></li>
									<li role="presentation"><a role="menuitem" tabindex="87" href="#">沒事別亂按</a></li>
								</ul>

							</div>
						</div>
						<div class="row" id="inputCDialog_2" style="background-color:rgb(250,250,250);padding:0px;width:350px;margin:5px;border-radius: 10px;">
							<h5 style="padding-left:12px">細部調整</h5>
							<div class="col-xs-6 span4" style="font-size: 12px ;margin-left: 5px;line-height: 22px;margin-top: 12px">
								speed <br>
								<line></line>
								frame Speed <br> Sprites Size <br> <span style="font-size: 12px"> random Size </span> <br> Sprites Rotate <br> Sprite Blur <br>
							</div>
							<div class="col-xs-6 span2" style="margin: 5px">
								<div id="speedSliderC" style="margin:10px;width:200px;">
									<!-- slide bar -->

									<div id="speedSliderC-handle" class="ui-slider-handle"></div>
								</div>
								<div id="frameSpeedC" style="margin:10px;width:200px">
									<div id="frameSpeedC-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpritesSizeC" style="margin:10px;width:200px">
									<div id="SpritesSizeC-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpritesSizeRandomC" style="margin:10px;width:200px">
									<div id="SpritesSizeRandomC-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpritesRotateC" style="margin:10px;width:200px">
									<div id="SpritesRotateC-handle" class="ui-slider-handle"></div>
								</div>
								<div id="SpriteBlurC" style="margin:10px;width:200px">
									<div id="SpriteBlurC-handle" class="ui-slider-handle"></div>
								</div>
								<button id="resetC" type="button" class="btn btn-info" style="height: 25px;width:100px;">RESET</button>
								<button id="applyC" type="button" class="btn btn-success" style="height: 25px;width:100px;margin-top: 5px;">APPLY</button>

							</div>
						</div>

					</div>

				</div>
				<div class="input-group" style="padding:12px; ">
					<h6>輸出圖檔</h6>
					<span class="input-group-addon" style="height: 20px; ">起始格</span>
					<input id="startFrame" type="number" class="form-control" name="startFrameMsg" value="1" style="text-align: center; width:30px ; height:16px;">
					<span class="input-group-addon" style="padding:3px; ">結束格</span>
					<input id="endFrame" type="number" class="form-control" name="endFrameMsg" value="1" style="text-align: center; width:30px ; height:16px;"> <br>
					<button type="button" class="btn btn-info" onclick="WriteToFile()">輸出圖檔</button>

				</div>
				<div>
					<h1>testtesttest</h1>
					<input type="file" accept="text/json" onchange="openFile(event)"><br>
					<button onclick="myFunction()">Click me</button>
				</div>

			</div>


			<div class="col-xs-6 -fluid" style="background-color: black;height:2000px; margin-left: 1px" ;>
				<!-- Left -->



			</div>

		</div>
	</div>
</body>
<!--initial data -->


<script>
	var KJJsonInputStyleA = {
		rtl: false,
		showPreview: false,
		showRemove: false,
		showUpload: false,
		showCancel: false,
		showCaption: false,
		browseClass: "btn btn-info",
		browseLabel: "選取檔案",
		allowedFileExtensions: ["json", "JSON"]
	};

	var KJImageInputStyleA = {
		rtl: false,
		showPreview: false,
		showRemove: false,
		showUpload: false,
		showCancel: false,
		showCaption: false,
		browseClass: "btn btn-success",
		browseLabel: "選取檔案",
		allowedFileExtensions: ["jpg", "png"]
	}


	$(document).ready(function() {
		$("#inputDataA").show();
		$("#inputDataB").hide();
		$("#inputDataC").hide();
		$("#input_a").click(function() {
			$("#inputDataA").toggle();
		});
		$("#inputB").click(function() {
			$("#inputDataB").toggle();
		});
		$("#inputC").click(function() {
			$("#inputDataC").toggle();
		});
		$("#infoBox").show();
		$("#inputExtA").click(function() {
			$("#infoBox").toggle();
		});
	});

	$("#screenMode_databox a").click(function(e) {
		e.preventDefault(); // cancel the link behaviour
		var screenModeText = $(this).text();
		$("#screenModeButton").text(screenModeText);
		var screenWidth = parseInt(screenModeText.split(" ")[1]);
		var screenHeight = parseInt(screenModeText.split(" ")[2]);
		var screenScale = parseFloat(screenModeText.split(" ")[4].split("=")[1]);
		console.log(screenWidth, screenHeight);
		PIXI_globalData.BGA.width = screenWidth;
		PIXI_globalData.BGA.height = screenHeight;
		PIXI_globalData.BGA.screenScale = screenScale;
		// console.log(screenScale);
		//$("#showScreenModeText").val(selText);
	});

	//get Bootstrap dropdown value inputADialog_3
	$("#databoxA a").click(function(e) {
		e.preventDefault(); // cancel the link behaviour
		var selText = $(this).text();
		$("#menuA_blendMode").text(selText);

		PIXI_globalData.inputA.blendMode = selText
	});

	$("#inputBGA").fileinput(KJImageInputStyleA);


	$('#inputBGA').on('fileloaded', function(event, data, previewId, index) {
		$("#showBGA").val("images/" + data.name);
		delete loader.resources["BGA_image"];
		var imageURL = "images/" + data.name
		PIXI_globalData.BGA.URL = imageURL;
		PIXI_loader("BGA_image", imageURL);
	});



	//input A----------------------------

	$(document).ready(function() {
		$("#optionsRadiosA1").click(function() {
			console.log('still Image');
			PIXI_globalData.inputA.spritesImageMode = 0;
		});
		$("#optionsRadiosA2").click(function() {
			console.log('sequence Images');
			PIXI_globalData.inputA.spritesImageMode = 1;
		});
	});




	$("#inputJsonA").fileinput(KJJsonInputStyleA); //load motion JsonA

	$('#inputJsonA').on('fileloaded', function(event, data, previewId, index) {
		// console.log(event, data, previewId, index,"filepreupload");
		// console.log(event, data, previewId, index, 'fileloaded');
		// console.log(data.name);
		$("#showMotionJsonA").val(data.name);
		delete loader.resources["MotionJsonA"];
		var jsonURL = "json/" + data.name
		//PIXI_loader("MotionJsonA", jsonURL); //load json file
		// console.log("jsonURL", jsonURL);
		// console.log('loader', resources);
		//motionData_A = resources["MotionJsonA"]
		PIXI_globalData.inputA.motionJson = jsonURL;
		//console.log(motionData_A)
		getMotioData("MotionJsonA",jsonURL,"effect_A");
	});




	$("#inputSpriteJsonA").fileinput(KJJsonInputStyleA); //load spritesImages jsonA

	$('#inputSpriteJsonA').on('fileloaded', function(event, data, previewId, index) {

		$("#showSpriteJsonA").val(data.name);
		delete loader.resources["spritesImagesJsonA"];
		delete loader.resources["spritesImagesJsonA_image"];
		var jsonURL = "sprites/" + data.name
		//PIXI_loader("spritesImagesJsonA", jsonURL);
		var imgURL = jsonURL.split('.')[0] + ".png"

		PIXI_globalData.inputA.spritesJson = jsonURL;
		PIXI_globalData.inputA.spritesImage = imgURL;
		//frameListA = resources["spritesImagesJsonA"];//Object.keys(resources.spritesImagesJsonA.data.frames);
		getSpritesImagesData("spritesImagesJsonA",jsonURL,"effect_A");
		//console.log("frameListA",frameListA);
		//var dd = PIXI.loader.resources["spritesImagesJsonA"];
		//loader.load()
		//console.log("read spritesImageJsonA",dd["data"]);




		//$("#info").val("");
		//$("#info").append("admin:"+$("#talk").val()+"\n");  

	});


	$("#stageDescriptJsonA").fileinput(KJJsonInputStyleA); //load spritesImages jsonA

	$('#stageDescriptJsonA').on('fileloaded', function(event, data, previewId, index) {

		$("#showStageDescriptJsonA").val(data.name);
		delete loader.resources["stageDescriptJsonA"];
		var jsonURL = "sprites/" + data.name
		PIXI_loader("stageDescriptJsonA", jsonURL);

		PIXI_globalData.inputA.stageDescriptJsonFile = jsonURL;
		PIXI_globalData.inputA.stageDescriptJsonData = "NONE";
		// console.log('PIXI_globalData',PIXI_globalData.inputA)
	});

	$("#inputJsonB").fileinput(KJJsonInputStyleA);

	$('#inputJsonB').on('fileloaded', function(event, data, previewId, index) {
		// console.log(event, data, previewId, index,"filepreupload");
		console.log(event, data, previewId, index, 'fileloaded');
		console.log(data.name);
		$("#showMotionJsonB").val(data.name);
	});

	$("#inputSpriteJsonB").fileinput(KJJsonInputStyleA);

	$("#inputSprtieImageB").fileinput(KJImageInputStyleA);




	$("#inputJsonC").fileinput(KJJsonInputStyleA);

	$('#inputJsonC').on('fileloaded', function(event, data, previewId, index) {
		// console.log(event, data, previewId, index,"filepreupload");
		console.log(event, data, previewId, index, 'fileloaded');
		console.log(data.name);
		$("#showMotionJsonC").val(data.name);
	});

	$("#inputSpriteJsonC").fileinput(KJJsonInputStyleA);

	$("#inputSprtieImageC").fileinput(KJImageInputStyleA);




	function WriteToFile(text) {


		window.location.href = image;

	}
	var JsonData = ""



	function myFunction() {
        deleteAllChildrenInStage("container_BG");
		console.log(miniApp.screen.width);
        effectEventTransform(1,"effect_A")
	};

	var openFile = function(event) {
		JsonData = ""
		var input = event.target;

		var reader = new FileReader();
		reader.onload = function() {
			var text = reader.result;
			JsonData += text
			console.log(JsonData.length);
		};
		reader.readAsText(input.files[0]);
		return JsonData
	};

	function ooo(event) {
		console.log('asdasd')
	}

</script>
<!--sliderA -->

<!--sliderB -->


</html>
